<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Deploying to Network-secured sites - Azure App Service</title>
<meta name="description" content="With the recently-announced Private Endpoints integration you can block inbound access from the internet to your web app. Before this integration, developers would need to use an App Service Environment (ASE) if they wanted to host their network-secured applications on App Service. With the combination of the Virtual Network (VNet) and Private Endpoint integrations on App Service, you can secure your site’s inbound and outbound requests respectively.This is great for organizations that want the network security without the added cost of an ASE. However, if inbound access to your site is blocked, that can disrupt your existing delivery pipeline if you were not using Private Endpoints before. This article will walk through the process of installing an Azure DevOps agent on a Virtual Machine (VM) to deploy to a site secured with VNet and Private Endpoints. This solution works for ILB ASEs as well.  This article assumes some familiarity with Virtual Networks. If you are new to Azure Networking, please see this Microsoft Learning Path.Solution OverviewThis guide will walk through the process of deploying a Virtual Machine Scale Set (VMSS) and web app into two subnets of the same virtual network. You wil use Azure DevOps to install a build agent on the virtual machines and configure your DevOps Pipeline to run on those agents. Finally, you will enable private endpoints so the site cannot be reached from the public internet.PrerequisitesTo follow this guide you will need the following:  A valid Azure subscription  An Azure DevOps organization and project  A DevOps repository with a web application we can deploy to App ServicePart 1: Set up resourcesFirst, let’s set up the Azure DevOps project and VM that will host the agent.  Create a Virtual Machine Scale Set with Ubuntu Server 18.04 LTS. This process will automatically create a VNet as well.  Once the VM Scale Set is created, open Azure DevOps and navigate to Project settings &gt; Pipelines &gt; Agent pools.  Click Add pool and this will open a context menu. Under Pool type select “Azure virtual machine scale set”. Choose your subscription and the VM Scale Set you just created. You can configure the max number of machines for the scale set, the number to keep on standby, and more. Read more information here.  Click Create to set up the agent pool. You can monitor the process under Diagnostics.Part 2: Configure networking featuresYou now have a VM Scale Set with DevOps agents installed, all deployed within a VNet. Now you will create the web app and confirm that the VM’s and webapp can communicate over the virtual network.  Create an Azure Webapp in the same region as the VM. Choose whatever runtime and operating system fit your application.      Once the web app is created, go to Networking &gt; VNet Integration. Add the site to the same virtual network as the VM. The VM and webapp cannot be in the same subnet, so you may need to create another subnet.    With VNet integration enabled, the web app and VM can communicate over the virtual network. To test this, go to the web console for your site at https://my-linux-site.scm.azurewebsites.net/webssh/host on Linux apps, or https://my-windows-site.scm.azurewebsites.net/DebugConsole/?shell=powershell for Windows. Once the console is open, run the following command to ping the VM’s private IP. You can find your VM’s private IP from the Networking blade on the VM resource. It’s shown under “NIC Private IP”.     root@87d2385265ad$ ping 10.0.0.5  # replace with your VM&#39;s private IP        Now that the resources are in the same Virtual Network and can communicate over that network, let’s enable Private Endpoints on the web app. This will block inbound access to the web app from the public internet.    In the Portal, go to your web app &gt; Networking &gt; Private Endpoint connections &gt; Configure your private endpoint connections &gt; + Add. This will open a context blade to configure the Private Endpoint. Provide a name, subscription, and Virtual network. Check the box to allow the service to integrate with Azure Private DNS zones. This will create a private DNS zone if one does not already exist, and set up the correct domain entries for your web app. Click OK to create the resources.      Once the private link and DNS resources are created, open an SSH connection to your VM. Run the command below to ping the web app and confirm that you can reach the site from the VM. If you cannot reach the site from the VM, the DevOps agent won’t be able to either!     curl your-site-name.azurewebsites.net        You can also use nslookup to see how the private DNS entries ultimately map to the web app.  Installing build tools on your VMsThe virtual machines in your scale set may not come with the build tools that your pipeline will need (like Maven, NPM, or dotnet). To install these tools, you can add the Custom Script for Linux Extension. This extension allows you to upload a shell script that is executed whenever a new VM is provisioned in the scale set. So in this case, the shell script could install your necessary build tools.Part 3: Create the CI pipelineAt this point the web app cannot be reached from the public internet but our VM can reach the site through the virtual network. Now let’s set up a DevOps Pipeline to build and deploy your application from the VM.  Head back to Azure DevOps and go to Pipelines &gt; New pipeline. Then select the location of your project.      Once you choose your project, Azure DevOps will show some templates based on your stack. For example, I was given a starter pipeline to build my Java app with Maven and deploy it to App Service Linux. Click Show more if you don’t immediately see a good starter template.    If you are not given a good template to deploy your app to App Service, use the generic starter template and add the Deploy to Azure Web App action.        Next, specify the VMSS agent pool by adding the pool keyword on the pipeline. The value should be the name of your VMSS agent pool that you created earlier.     trigger: - main pool: &#39;VMSS for private endpoints deployment&#39;  # This is the name of your agent pool steps:   - task: AzureWebApp@1     displayName: &#39;Azure Web App Deploy: priv-endpoints-webapp&#39;     inputs:       azureSubscription: &#39;aaaaaa-bbbb-cccc-dddd-eeeeeeeeee&#39;       appType: webAppLinux       appName: &#39;priv-endpoints-webapp&#39;       package: &#39;app.jar&#39;        Finally, save and run the workflow! See the pipeline’s logs to monitor progress and check for any errors.Resources  Using Private Endpoints for Azure Web App  Integrate your app with an Azure virtual network  Azure Private Link documentation  Azure virtual machine scale set DevOps agents">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Azure App Service">
<meta property="og:title" content="Deploying to Network-secured sites">
<meta property="og:url" content="https://azure.github.io/AppService/2021/01/04/deploying-to-network-secured-sites.html">


  <meta property="og:description" content="With the recently-announced Private Endpoints integration you can block inbound access from the internet to your web app. Before this integration, developers would need to use an App Service Environment (ASE) if they wanted to host their network-secured applications on App Service. With the combination of the Virtual Network (VNet) and Private Endpoint integrations on App Service, you can secure your site’s inbound and outbound requests respectively.This is great for organizations that want the network security without the added cost of an ASE. However, if inbound access to your site is blocked, that can disrupt your existing delivery pipeline if you were not using Private Endpoints before. This article will walk through the process of installing an Azure DevOps agent on a Virtual Machine (VM) to deploy to a site secured with VNet and Private Endpoints. This solution works for ILB ASEs as well.  This article assumes some familiarity with Virtual Networks. If you are new to Azure Networking, please see this Microsoft Learning Path.Solution OverviewThis guide will walk through the process of deploying a Virtual Machine Scale Set (VMSS) and web app into two subnets of the same virtual network. You wil use Azure DevOps to install a build agent on the virtual machines and configure your DevOps Pipeline to run on those agents. Finally, you will enable private endpoints so the site cannot be reached from the public internet.PrerequisitesTo follow this guide you will need the following:  A valid Azure subscription  An Azure DevOps organization and project  A DevOps repository with a web application we can deploy to App ServicePart 1: Set up resourcesFirst, let’s set up the Azure DevOps project and VM that will host the agent.  Create a Virtual Machine Scale Set with Ubuntu Server 18.04 LTS. This process will automatically create a VNet as well.  Once the VM Scale Set is created, open Azure DevOps and navigate to Project settings &gt; Pipelines &gt; Agent pools.  Click Add pool and this will open a context menu. Under Pool type select “Azure virtual machine scale set”. Choose your subscription and the VM Scale Set you just created. You can configure the max number of machines for the scale set, the number to keep on standby, and more. Read more information here.  Click Create to set up the agent pool. You can monitor the process under Diagnostics.Part 2: Configure networking featuresYou now have a VM Scale Set with DevOps agents installed, all deployed within a VNet. Now you will create the web app and confirm that the VM’s and webapp can communicate over the virtual network.  Create an Azure Webapp in the same region as the VM. Choose whatever runtime and operating system fit your application.      Once the web app is created, go to Networking &gt; VNet Integration. Add the site to the same virtual network as the VM. The VM and webapp cannot be in the same subnet, so you may need to create another subnet.    With VNet integration enabled, the web app and VM can communicate over the virtual network. To test this, go to the web console for your site at https://my-linux-site.scm.azurewebsites.net/webssh/host on Linux apps, or https://my-windows-site.scm.azurewebsites.net/DebugConsole/?shell=powershell for Windows. Once the console is open, run the following command to ping the VM’s private IP. You can find your VM’s private IP from the Networking blade on the VM resource. It’s shown under “NIC Private IP”.     root@87d2385265ad$ ping 10.0.0.5  # replace with your VM&#39;s private IP        Now that the resources are in the same Virtual Network and can communicate over that network, let’s enable Private Endpoints on the web app. This will block inbound access to the web app from the public internet.    In the Portal, go to your web app &gt; Networking &gt; Private Endpoint connections &gt; Configure your private endpoint connections &gt; + Add. This will open a context blade to configure the Private Endpoint. Provide a name, subscription, and Virtual network. Check the box to allow the service to integrate with Azure Private DNS zones. This will create a private DNS zone if one does not already exist, and set up the correct domain entries for your web app. Click OK to create the resources.      Once the private link and DNS resources are created, open an SSH connection to your VM. Run the command below to ping the web app and confirm that you can reach the site from the VM. If you cannot reach the site from the VM, the DevOps agent won’t be able to either!     curl your-site-name.azurewebsites.net        You can also use nslookup to see how the private DNS entries ultimately map to the web app.  Installing build tools on your VMsThe virtual machines in your scale set may not come with the build tools that your pipeline will need (like Maven, NPM, or dotnet). To install these tools, you can add the Custom Script for Linux Extension. This extension allows you to upload a shell script that is executed whenever a new VM is provisioned in the scale set. So in this case, the shell script could install your necessary build tools.Part 3: Create the CI pipelineAt this point the web app cannot be reached from the public internet but our VM can reach the site through the virtual network. Now let’s set up a DevOps Pipeline to build and deploy your application from the VM.  Head back to Azure DevOps and go to Pipelines &gt; New pipeline. Then select the location of your project.      Once you choose your project, Azure DevOps will show some templates based on your stack. For example, I was given a starter pipeline to build my Java app with Maven and deploy it to App Service Linux. Click Show more if you don’t immediately see a good starter template.    If you are not given a good template to deploy your app to App Service, use the generic starter template and add the Deploy to Azure Web App action.        Next, specify the VMSS agent pool by adding the pool keyword on the pipeline. The value should be the name of your VMSS agent pool that you created earlier.     trigger: - main pool: &#39;VMSS for private endpoints deployment&#39;  # This is the name of your agent pool steps:   - task: AzureWebApp@1     displayName: &#39;Azure Web App Deploy: priv-endpoints-webapp&#39;     inputs:       azureSubscription: &#39;aaaaaa-bbbb-cccc-dddd-eeeeeeeeee&#39;       appType: webAppLinux       appName: &#39;priv-endpoints-webapp&#39;       package: &#39;app.jar&#39;        Finally, save and run the workflow! See the pipeline’s logs to monitor progress and check for any errors.Resources  Using Private Endpoints for Azure Web App  Integrate your app with an Azure virtual network  Azure Private Link documentation  Azure virtual machine scale set DevOps agents">



  <meta property="og:image" content="https://azure.github.io/AppService/assets/images/icon.png">





  <meta property="article:published_time" content="2021-01-04T00:00:00+00:00">





  

  


<link rel="canonical" href="https://azure.github.io/AppService/2021/01/04/deploying-to-network-secured-sites.html">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://azure.github.io/AppService",
      "logo": "https://azure.github.io/AppService/assets/images/icon.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Azure App Service",
      "url": "https://azure.github.io/AppService",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/AppService/feed.xml" type="application/atom+xml" rel="alternate" title="Azure App Service Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/AppService/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->

<!-- Jekyll env: production -->



    <!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" 
      type="image/png" 
      href="/AppService/media/pages/new_app_service_logo_16.png">
<link rel="shortcut icon" 
      type="image/png" 
      href="/AppService/media/pages/new_app_service_logo_16.png">

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/AppService/"><img src="/AppService/media/pages/new_app_service_logo_64.svg" alt=""></a>
        
        <a class="site-title" href="/AppService/">
          Azure App Service
          <span class="site-subtitle">Team Blog</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/AppService/tags/" >Tags</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/AppService/"><span class="nav__sub-title">Home</span></a>
        

        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Product Areas</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="/AppService/networking/" class="">Networking & ASE</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/java/" class="">Java</a>
              
                
                
                
                
    
                
                
                <ul>
                  <li style="padding-left: 6px;"><a href="/AppService/java/videos/" class="">Videos</a></li>
                </ul>
                
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/diagnostics/" class="">Diagnostics</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/certsdomains/" class="">Certs and Domains</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/deployment/" class="">Deployment, CI/CD, Slots</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/windows-containers/" class="">Windows Containers</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/sidecars/" class="">Sidecars</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/ai-integration/" class="">AI Integration</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Reference</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="https://docs.microsoft.com/azure/app-service/" class="">Documentation</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://github.com/Azure/app-service-linux-docs" class="">Linux FAQ</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://aka.ms/appservicewindowscontainerwiki" class="">Windows Containers Wiki</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/zero-to-hero/" class="">Zero to Hero tutorials</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">More</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="https://twitter.com/Azure" class="">Twitter</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/feed.xml" class="">RSS Feed</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://azure.microsoft.com/blog/" class="">Azure Blog</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://azure.microsoft.com/updates/" class="">Azure Updates</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Archives</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="/AppService/2020" class="">2020</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2019" class="">2019</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2018" class="">2018</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2017" class="">2017</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2016" class="">2016</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/posts/" class="">All posts</a>
              
            </li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Deploying to Network-secured sites">
    <meta itemprop="description" content="With the recently-announced Private Endpoints integration you can block inbound access from the internet to your web app. Before this integration, developers would need to use an App Service Environment (ASE) if they wanted to host their network-secured applications on App Service. With the combination of the Virtual Network (VNet) and Private Endpoint integrations on App Service, you can secure your site’s inbound and outbound requests respectively.This is great for organizations that want the network security without the added cost of an ASE. However, if inbound access to your site is blocked, that can disrupt your existing delivery pipeline if you were not using Private Endpoints before. This article will walk through the process of installing an Azure DevOps agent on a Virtual Machine (VM) to deploy to a site secured with VNet and Private Endpoints. This solution works for ILB ASEs as well.  This article assumes some familiarity with Virtual Networks. If you are new to Azure Networking, please see this Microsoft Learning Path.Solution OverviewThis guide will walk through the process of deploying a Virtual Machine Scale Set (VMSS) and web app into two subnets of the same virtual network. You wil use Azure DevOps to install a build agent on the virtual machines and configure your DevOps Pipeline to run on those agents. Finally, you will enable private endpoints so the site cannot be reached from the public internet.PrerequisitesTo follow this guide you will need the following:  A valid Azure subscription  An Azure DevOps organization and project  A DevOps repository with a web application we can deploy to App ServicePart 1: Set up resourcesFirst, let’s set up the Azure DevOps project and VM that will host the agent.  Create a Virtual Machine Scale Set with Ubuntu Server 18.04 LTS. This process will automatically create a VNet as well.  Once the VM Scale Set is created, open Azure DevOps and navigate to Project settings &gt; Pipelines &gt; Agent pools.  Click Add pool and this will open a context menu. Under Pool type select “Azure virtual machine scale set”. Choose your subscription and the VM Scale Set you just created. You can configure the max number of machines for the scale set, the number to keep on standby, and more. Read more information here.  Click Create to set up the agent pool. You can monitor the process under Diagnostics.Part 2: Configure networking featuresYou now have a VM Scale Set with DevOps agents installed, all deployed within a VNet. Now you will create the web app and confirm that the VM’s and webapp can communicate over the virtual network.  Create an Azure Webapp in the same region as the VM. Choose whatever runtime and operating system fit your application.      Once the web app is created, go to Networking &gt; VNet Integration. Add the site to the same virtual network as the VM. The VM and webapp cannot be in the same subnet, so you may need to create another subnet.    With VNet integration enabled, the web app and VM can communicate over the virtual network. To test this, go to the web console for your site at https://my-linux-site.scm.azurewebsites.net/webssh/host on Linux apps, or https://my-windows-site.scm.azurewebsites.net/DebugConsole/?shell=powershell for Windows. Once the console is open, run the following command to ping the VM’s private IP. You can find your VM’s private IP from the Networking blade on the VM resource. It’s shown under “NIC Private IP”.     root@87d2385265ad$ ping 10.0.0.5  # replace with your VM&#39;s private IP        Now that the resources are in the same Virtual Network and can communicate over that network, let’s enable Private Endpoints on the web app. This will block inbound access to the web app from the public internet.    In the Portal, go to your web app &gt; Networking &gt; Private Endpoint connections &gt; Configure your private endpoint connections &gt; + Add. This will open a context blade to configure the Private Endpoint. Provide a name, subscription, and Virtual network. Check the box to allow the service to integrate with Azure Private DNS zones. This will create a private DNS zone if one does not already exist, and set up the correct domain entries for your web app. Click OK to create the resources.      Once the private link and DNS resources are created, open an SSH connection to your VM. Run the command below to ping the web app and confirm that you can reach the site from the VM. If you cannot reach the site from the VM, the DevOps agent won’t be able to either!     curl your-site-name.azurewebsites.net        You can also use nslookup to see how the private DNS entries ultimately map to the web app.  Installing build tools on your VMsThe virtual machines in your scale set may not come with the build tools that your pipeline will need (like Maven, NPM, or dotnet). To install these tools, you can add the Custom Script for Linux Extension. This extension allows you to upload a shell script that is executed whenever a new VM is provisioned in the scale set. So in this case, the shell script could install your necessary build tools.Part 3: Create the CI pipelineAt this point the web app cannot be reached from the public internet but our VM can reach the site through the virtual network. Now let’s set up a DevOps Pipeline to build and deploy your application from the VM.  Head back to Azure DevOps and go to Pipelines &gt; New pipeline. Then select the location of your project.      Once you choose your project, Azure DevOps will show some templates based on your stack. For example, I was given a starter pipeline to build my Java app with Maven and deploy it to App Service Linux. Click Show more if you don’t immediately see a good starter template.    If you are not given a good template to deploy your app to App Service, use the generic starter template and add the Deploy to Azure Web App action.        Next, specify the VMSS agent pool by adding the pool keyword on the pipeline. The value should be the name of your VMSS agent pool that you created earlier.     trigger: - main pool: &#39;VMSS for private endpoints deployment&#39;  # This is the name of your agent pool steps:   - task: AzureWebApp@1     displayName: &#39;Azure Web App Deploy: priv-endpoints-webapp&#39;     inputs:       azureSubscription: &#39;aaaaaa-bbbb-cccc-dddd-eeeeeeeeee&#39;       appType: webAppLinux       appName: &#39;priv-endpoints-webapp&#39;       package: &#39;app.jar&#39;        Finally, save and run the workflow! See the pipeline’s logs to monitor progress and check for any errors.Resources  Using Private Endpoints for Azure Web App  Integrate your app with an Azure virtual network  Azure Private Link documentation  Azure virtual machine scale set DevOps agents">
    <meta itemprop="datePublished" content="January 04, 2021">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Deploying to Network-secured sites
</h1>
          <p class="page__meta">
            
              <i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read

            
            
              • By Jason Freeberg
            
            • January 4, 2021
          </p>
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#solution-overview">Solution Overview</a></li>
  <li><a href="#prerequisites">Prerequisites</a></li>
  <li><a href="#part-1-set-up-resources">Part 1: Set up resources</a></li>
  <li><a href="#part-2-configure-networking-features">Part 2: Configure networking features</a>
    <ul>
      <li><a href="#installing-build-tools-on-your-vms">Installing build tools on your VMs</a></li>
    </ul>
  </li>
  <li><a href="#part-3-create-the-ci-pipeline">Part 3: Create the CI pipeline</a></li>
  <li><a href="#resources">Resources</a></li>
</ul>
            </nav>
          </aside>
        
        <p>With the recently-announced <a href="https://azure.github.io/AppService/2020/10/06/private-endpoint-app-service-ga.html">Private Endpoints integration</a> you can block inbound access from the internet to your web app. Before this integration, developers would need to use an App Service Environment (ASE) if they wanted to host their network-secured applications on App Service. With the combination of the Virtual Network (VNet) and Private Endpoint integrations on App Service, you can secure your site’s inbound and outbound requests respectively.</p>

<p>This is great for organizations that want the network security without the added cost of an ASE. However, if inbound access to your site is blocked, that can disrupt your existing delivery pipeline if you were not using Private Endpoints before. This article will walk through the process of installing an Azure DevOps agent on a Virtual Machine (VM) to deploy to a site secured with VNet and Private Endpoints. This solution works for <a href="https://docs.microsoft.com/azure/app-service/environment/create-ilb-ase">ILB ASEs</a> as well.</p>

<blockquote>
  <p>This article assumes some familiarity with Virtual Networks. If you are new to Azure Networking, please see this <a href="https://docs.microsoft.com/learn/modules/network-fundamentals/">Microsoft Learning Path</a>.</p>
</blockquote>

<h2 id="solution-overview">Solution Overview</h2>

<p>This guide will walk through the process of deploying a Virtual Machine Scale Set (VMSS) and web app into two subnets of the same virtual network. You wil use Azure DevOps to install a build agent on the virtual machines and configure your DevOps Pipeline to run on those agents. Finally, you will enable private endpoints so the site cannot be reached from the public internet.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To follow this guide you will need the following:</p>

<ul>
  <li>A valid Azure subscription</li>
  <li>An Azure DevOps organization and project</li>
  <li>A DevOps repository with a web application we can deploy to App Service</li>
</ul>

<h2 id="part-1-set-up-resources">Part 1: Set up resources</h2>

<p>First, let’s set up the Azure DevOps project and VM that will host the agent.</p>

<ol>
  <li>Create a Virtual Machine Scale Set with Ubuntu Server 18.04 LTS. This process will automatically create a VNet as well.</li>
  <li>Once the VM Scale Set is created, open Azure DevOps and navigate to <strong>Project settings</strong> &gt; <strong>Pipelines</strong> &gt; <strong>Agent pools</strong>.</li>
  <li>Click <strong>Add pool</strong> and this will open a context menu. Under <strong>Pool type</strong> select “Azure virtual machine scale set”. Choose your subscription and the VM Scale Set you just created. You can configure the max number of machines for the scale set, the number to keep on standby, and more. Read more information <a href="https://docs.microsoft.com/azure/devops/pipelines/licensing/concurrent-jobs?view=azure-devops&amp;tabs=self-hosted">here</a>.</li>
  <li>Click <strong>Create</strong> to set up the agent pool. You can monitor the process under <strong>Diagnostics</strong>.</li>
</ol>

<h2 id="part-2-configure-networking-features">Part 2: Configure networking features</h2>

<p>You now have a VM Scale Set with DevOps agents installed, all deployed within a VNet. Now you will create the web app and confirm that the VM’s and webapp can communicate over the virtual network.</p>

<ol>
  <li><a href="https://portal.azure.com/#create/Microsoft.WebSite">Create an Azure Webapp</a> <em>in the same region</em> as the VM. Choose whatever runtime and operating system fit your application.</li>
  <li>
    <p>Once the web app is created, go to <strong>Networking</strong> &gt; <strong>VNet Integration</strong>. Add the site to the same virtual network as the VM. The VM and webapp cannot be in the same subnet, so you may need to create another subnet.</p>

    <p>With VNet integration enabled, the web app and VM can communicate over the virtual network. To test this, go to the web console for your site at <em>https://my-linux-site.scm.azurewebsites.net/webssh/host</em> on Linux apps, or <em>https://my-windows-site.scm.azurewebsites.net/DebugConsole/?shell=powershell</em> for Windows. Once the console is open, run the following command to ping the VM’s private IP. You can find your VM’s private IP from the <strong>Networking</strong> blade on the VM resource. It’s shown under “NIC Private IP”.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@87d2385265ad<span class="nv">$ </span>ping 10.0.0.5  <span class="c"># replace with your VM's private IP</span>
</code></pre></div>    </div>

    <p>Now that the resources are in the same Virtual Network and can communicate over that network, let’s enable Private Endpoints on the web app. This will block inbound access to the web app from the public internet.</p>
  </li>
  <li>In the Portal, go to your web app &gt; <strong>Networking</strong> &gt; <strong>Private Endpoint connections</strong> &gt; <strong>Configure your private endpoint connections</strong> &gt; <strong>+ Add</strong>. This will open a context blade to configure the Private Endpoint. Provide a name, subscription, and Virtual network. Check the box to allow the service to integrate with Azure Private DNS zones. This will create a private DNS zone if one does not already exist, and set up the correct domain entries for your web app. Click <strong>OK</strong> to create the resources.</li>
  <li>
    <p>Once the private link and DNS resources are created, open an SSH connection to your VM. Run the command below to ping the web app and confirm that you can reach the site from the VM. If you cannot reach the site from the VM, the DevOps agent won’t be able to either!</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> curl your-site-name.azurewebsites.net
</code></pre></div>    </div>

    <p>You can also use <code class="language-plaintext highlighter-rouge">nslookup</code> to see how the private DNS entries ultimately map to the web app.</p>
  </li>
</ol>

<h3 id="installing-build-tools-on-your-vms">Installing build tools on your VMs</h3>

<p>The virtual machines in your scale set may not come with the build tools that your pipeline will need (like Maven, NPM, or dotnet). To install these tools, you can add the <a href="https://github.com/Azure/azure-linux-extensions/tree/master/CustomScript"><strong>Custom Script for Linux Extension</strong></a>. This extension allows you to upload a shell script that is executed whenever a new VM is provisioned in the scale set. So in this case, the shell script could install your necessary build tools.</p>

<h2 id="part-3-create-the-ci-pipeline">Part 3: Create the CI pipeline</h2>

<p>At this point the web app cannot be reached from the public internet but our VM can reach the site through the virtual network. Now let’s set up a DevOps Pipeline to build and deploy your application from the VM.</p>

<ol>
  <li>Head back to Azure DevOps and go to <strong>Pipelines</strong> &gt; <strong>New pipeline</strong>. Then select the location of your project.</li>
  <li>
    <p>Once you choose your project, Azure DevOps will show some templates based on your stack. For example, I was given a starter pipeline to build my Java app with Maven and deploy it to App Service Linux. Click <strong>Show more</strong> if you don’t immediately see a good starter template.</p>

    <p>If you are not given a good template to deploy your app to App Service, use the generic starter template and add the <a href="https://docs.microsoft.com/azure/devops/pipelines/targets/webapp?view=azure-devops&amp;tabs=yaml">Deploy to Azure Web App</a> action.</p>
  </li>
  <li>
    <p>Next, specify the VMSS agent pool by adding <a href="https://docs.microsoft.com/azure/devops/pipelines/yaml-schema?view=azure-devops&amp;tabs=schema%2Cparameter-schema#pool">the <code class="language-plaintext highlighter-rouge">pool</code> keyword</a> on the pipeline. The value should be the name of your VMSS agent pool that you created earlier.</p>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">trigger</span><span class="pi">:</span>
 <span class="pi">-</span> <span class="s">main</span>

 <span class="na">pool</span><span class="pi">:</span> <span class="s1">'</span><span class="s">VMSS</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">private</span><span class="nv"> </span><span class="s">endpoints</span><span class="nv"> </span><span class="s">deployment'</span>  <span class="c1"># This is the name of your agent pool</span>

 <span class="na">steps</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">AzureWebApp@1</span>
     <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Azure</span><span class="nv"> </span><span class="s">Web</span><span class="nv"> </span><span class="s">App</span><span class="nv"> </span><span class="s">Deploy:</span><span class="nv"> </span><span class="s">priv-endpoints-webapp'</span>
     <span class="na">inputs</span><span class="pi">:</span>
       <span class="na">azureSubscription</span><span class="pi">:</span> <span class="s1">'</span><span class="s">aaaaaa-bbbb-cccc-dddd-eeeeeeeeee'</span>
       <span class="na">appType</span><span class="pi">:</span> <span class="s">webAppLinux</span>
       <span class="na">appName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">priv-endpoints-webapp'</span>
       <span class="na">package</span><span class="pi">:</span> <span class="s1">'</span><span class="s">app.jar'</span>
</code></pre></div>    </div>
  </li>
  <li>Finally, save and run the workflow! See the pipeline’s logs to monitor progress and check for any errors.</li>
</ol>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://docs.microsoft.com/azure/app-service/networking/private-endpoint">Using Private Endpoints for Azure Web App</a></li>
  <li><a href="https://docs.microsoft.com/azure/app-service/web-sites-integrate-with-vnet">Integrate your app with an Azure virtual network</a></li>
  <li><a href="https://docs.microsoft.com/azure/private-link/">Azure Private Link documentation</a></li>
  <li><a href="https://docs.microsoft.com/azure/devops/pipelines/agents/scale-set-agents?view=azure-devops">Azure virtual machine scale set DevOps agents</a></li>
</ul>

        
      </section>

      <footer class="page__meta">
          <p class="page__date"><strong><a href="https://docs.microsoft.com/answers/topics/azure-webapps.html">Post questions</a> | <a href="https://feedback.azure.com/forums/169385-web-apps">Provide product feedback</a></strong></p>
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-01-04T00:00:00+00:00">January 04, 2021</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Deploying+to+Network-secured+sites%20https%3A%2F%2Fazure.github.io%2FAppService%2F2021%2F01%2F04%2Fdeploying-to-network-secured-sites.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fazure.github.io%2FAppService%2F2021%2F01%2F04%2Fdeploying-to-network-secured-sites.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fazure.github.io%2FAppService%2F2021%2F01%2F04%2Fdeploying-to-network-secured-sites.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/AppService/2020/12/11/cicd-for-python-apps.html" class="pagination--pager" title="Using GitHub Actions for Python Applications
">Previous</a>
    
    
      <a href="/AppService/2021/01/06/Migrate-from-Windows-Azure-Pack-Websites-to-Azure-App-Service.html" class="pagination--pager" title="Migrate from Windows Azure Pack Websites to Azure App Service
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/11/04/app-service-agent-framework-part-3.html" rel="permalink">Part 3: Client-Side Multi-Agent Orchestration on Azure App Service with Microsoft Agent Framework
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  12 minute read

        
        
          • By Jordan Selig
        
        • November 4, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">In Part 2 of this series, I showed you how to build sophisticated multi-agent systems on Azure App Service using Azure AI Foundry Agents—server-side managed ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/31/app-service-agent-framework-part-2.html" rel="permalink">Part 2: Build Long-Running AI Agents on Azure App Service with Microsoft Agent Framework
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  9 minute read

        
        
          • By Jordan Selig
        
        • October 31, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">Last week, I shared how to build long-running AI agents on Azure App Service with Microsoft Agent Framework. If you haven’t seen that post yet, I would recom...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/29/node24-available.html" rel="permalink">Node.js 24 is now available on Azure App Service for Linux
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

        
        
          • By Tulika Chaudharie
        
        • October 29, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">Node.js 24 LTS is live on Azure App Service for Linux. You can create a new Node 24 app through the Azure portal, automate it with the Azure CLI, or roll it ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/29/VSTS-tasks-for-sidecars.html" rel="permalink">Azure Pipeline samples: add sidecars to Azure App Service for Linux
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

        
        
          • By Tulika Chaudharie
        
        • October 29, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">Sidecars on Azure App Service let you attach extra containers — logging, telemetry, lightweight APIs, caches, AI inference helpers — alongside your main app,...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id">
    <label class="sr-only" for="cse-search-input-box-id">
      Enter your search term...
    </label>
    <input type="search" id="cse-search-input-box-id" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results">
    <gcse:searchresults-only></gcse:searchresults-only>
  </div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  
    <a class="page-microsoft" href="https://www.microsoft.com"><img src="/AppService/media/pages/Microsoft_logo.svg" alt=""></a>
  
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/AzAppService" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/Azure/AppService" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/AppService/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 Azure App Service. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/AppService/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>


<script>
  (function () {
    var cx = '015057007851139702326:ob8gaepprli';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
    $(document).ready(function () {
      $('input#cse-search-input-box-id').on('keyup', function () {
        googleCustomSearchExecute();
      });
    });
  
</script>




  <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-112478220-2']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>









  </body>
</html>
