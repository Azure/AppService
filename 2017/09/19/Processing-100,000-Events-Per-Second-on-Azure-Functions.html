<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Processing 100,000 Events Per Second on Azure Functions - Azure App Service</title>
<meta name="description" content="">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Azure App Service">
<meta property="og:title" content="Processing 100,000 Events Per Second on Azure Functions">
<meta property="og:url" content="https://azure.github.io/AppService/2017/09/19/Processing-100,000-Events-Per-Second-on-Azure-Functions.html">


  <meta property="og:description" content="">



  <meta property="og:image" content="https://azure.github.io/AppService/assets/images/icon.png">





  <meta property="article:published_time" content="2017-09-19T00:00:00+00:00">





  

  


<link rel="canonical" href="https://azure.github.io/AppService/2017/09/19/Processing-100,000-Events-Per-Second-on-Azure-Functions.html">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://azure.github.io/AppService",
      "logo": "https://azure.github.io/AppService/assets/images/icon.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Azure App Service",
      "url": "https://azure.github.io/AppService",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/AppService/feed.xml" type="application/atom+xml" rel="alternate" title="Azure App Service Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/AppService/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->

<!-- Jekyll env: production -->



    <!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" 
      type="image/png" 
      href="/AppService/media/pages/new_app_service_logo_16.png">
<link rel="shortcut icon" 
      type="image/png" 
      href="/AppService/media/pages/new_app_service_logo_16.png">

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/AppService/"><img src="/AppService/media/pages/new_app_service_logo_64.svg" alt=""></a>
        
        <a class="site-title" href="/AppService/">
          Azure App Service
          <span class="site-subtitle">Team Blog</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/AppService/tags/" >Tags</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/AppService/"><span class="nav__sub-title">Home</span></a>
        

        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Product Areas</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="/AppService/networking/" class="">Networking & ASE</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/java/" class="">Java</a>
              
                
                
                
                
    
                
                
                <ul>
                  <li style="padding-left: 6px;"><a href="/AppService/java/videos/" class="">Videos</a></li>
                </ul>
                
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/diagnostics/" class="">Diagnostics</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/certsdomains/" class="">Certs and Domains</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/deployment/" class="">Deployment, CI/CD, Slots</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/windows-containers/" class="">Windows Containers</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/sidecars/" class="">Sidecars</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/ai-integration/" class="">AI Integration</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Reference</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="https://docs.microsoft.com/azure/app-service/" class="">Documentation</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://github.com/Azure/app-service-linux-docs" class="">Linux FAQ</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://aka.ms/appservicewindowscontainerwiki" class="">Windows Containers Wiki</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/zero-to-hero/" class="">Zero to Hero tutorials</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">More</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="https://twitter.com/Azure" class="">Twitter</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/feed.xml" class="">RSS Feed</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://azure.microsoft.com/blog/" class="">Azure Blog</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://azure.microsoft.com/updates/" class="">Azure Updates</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Archives</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="/AppService/2020" class="">2020</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2019" class="">2019</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2018" class="">2018</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2017" class="">2017</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2016" class="">2016</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/posts/" class="">All posts</a>
              
            </li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Processing 100,000 Events Per Second on Azure Functions">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="September 19, 2017">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Processing 100,000 Events Per Second on Azure Functions
</h1>
          <p class="page__meta">
            
              <i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read

            
            
            • September 19, 2017
          </p>
        </header>
      

      <section class="page__content" itemprop="text">
        
        <html><head>
<meta charset="utf-8"/>
</head>
<body>
<div id="page">

<a class="url fn n profile-usercard-hover" href="https://social.msdn.microsoft.com/profile/Paul Batum" target="_blank">Paul Batum</a>
<time>    9/19/2017 7:07:33 PM</time>
<hr/>
<div id="content">Customers often ask us about the scalability/throughput limits of the consumption plan for <a href="https://azure.microsoft.com/en-us/services/functions/">Azure Functions</a>. The short answer is always "it depends, what does your workload look like?". Today I want to talk about running high scale Event Hub / IOT Hub workloads on Functions and some key points to be aware of in order to maximize the performance you get from the platform.

We partnered with the <a href="https://blogs.msdn.microsoft.com/azurecat/2017/01/05/hello-world-welcome-to-azurecat-guidance/">Azure CAT team</a> to build a simple but representative event processing pipeline using Functions and <a href="https://azure.microsoft.com/en-us/services/event-hubs/">Event Hubs</a>, with telemetry going into <a href="https://azure.microsoft.com/en-us/services/application-insights/">Application Insights</a>:

<a href="/AppService/media/2017/09/01-overview.png"><img alt="" class="aligncenter wp-image-5865 size-full" height="448" src="/AppService/media/2017/09/01-overview.png" width="1272"/></a>

The load generator (also running on Functions) writes batched messages to an ingestion event hub. These messages represent a set of readings from a given sensor. Functions picks up messages from the ingestion event hub, extracts individual readings from the batch and writes them to the target event hub, augmenting the messages with additional telemetry along the way. Two more functions within the same function app (on the consumption plan) each process the individual readings and send aggregated telemetry to App Insights.
<h2>Performance</h2>
We ran the system under a target load of 100,000 events per second for a total of 9 days. Over that time the system processed a total of 76 billion events. We measured the e2e latency of the pipeline i.e. amount of time taken between writing the message to the ingestion hub and processing the message in the weather/seismic function. Here are the results:
<h6><strong>E2E Latency Percentiles</strong></h6>
<div style="direction: ltr">
<table border="1" cellpadding="0" cellspacing="0" style="direction: ltr;border-collapse: collapse;border: 1pt solid #A3A3A3" summary="" title="">
<tbody>
<tr>
<td style="vertical-align: top;width: .925in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt"><span style="font-weight: bold">P50</span></p>
</td>
<td style="vertical-align: top;width: .925in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt"><span style="font-weight: bold">P90</span></p>
</td>
<td style="vertical-align: top;width: .925in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt"><span style="font-weight: bold">P95</span></p>
</td>
<td style="vertical-align: top;width: 1.0027in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt"><span style="font-weight: bold">P99</span></p>
</td>
<td style="vertical-align: top;width: 1.0027in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt"><span style="font-weight: bold">P99.9</span></p>
</td>
<td style="vertical-align: top;width: 1.0798in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt"><span style="font-weight: bold">P99.99</span></p>
</td>
<td style="vertical-align: top;width: .8305in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt"><span style="font-weight: bold">Max</span></p>
</td>
</tr>
<tr>
<td style="vertical-align: top;width: .9444in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">1,102.42ms</p>
</td>
<td style="vertical-align: top;width: .9444in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">2,755.56ms</p>
</td>
<td style="vertical-align: top;width: .9444in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">3,788.30ms</p>
</td>
<td style="vertical-align: top;width: 1.0222in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">11,894.12ms</p>
</td>
<td style="vertical-align: top;width: 1.0222in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">50,367.23ms</p>
</td>
<td style="vertical-align: top;width: 1.0993in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">111,240.50ms</p>
</td>
<td style="vertical-align: top;width: 1.0159in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">239,890.10ms</p>
</td>
</tr>
</tbody>
</table>
</div>
In simple terms:
<ul>
<li>half of the messages were processed within 1.2 seconds of being written to the ingestion hub</li>
<li>nine out of ten messages were processed in under 3 seconds</li>
<li>999 out of 1000 messages were processed in under 1 minute</li>
<li>all messages were processed in under 5 minutes</li>
</ul>
<h2>Monitoring</h2>
Azure Functions has two built in monitoring solutions - the WebJobs dashboard and Application Insights (integration between Azure Functions and App Insights is currently in preview). The dashboard was designed with longer running jobs in mind and isn't optimized for scenarios where there are 10,000+ function executions happening per second. Fortunately, App Insights is an incredibly robust telemetry system and we've made sure that it works great with Azure Functions in high scale scenarios.

Turning on App insights is really easy - just add your instrumentation key to your function app and Azure Functions will start sending data to App Insights automatically. For more info see <a href="https://blogs.msdn.microsoft.com/appserviceteam/2017/04/06/azure-functions-application-insights/">here</a>.

The Azure dashboard is highly customizable and App Insights has great support for pinning its visual components. It only took an hour or two to put together a pretty useful monitoring dashboard for this scenario:
<h3><a href="/AppService/media/2017/09/02-monitoring.png"><img alt="" class="wp-image-5875 size-large aligncenter" height="396" src="/AppService/media/2017/09/02-monitoring-1024x461.png" width="879"/></a></h3>
<h2>Configuration</h2>
We made some notable configuration choices to achieve this result:
<ul>
<li>the functions process messages in batches</li>
<li>the WebJobs dashboard is disabled in favor of using Application Insights for monitoring and telemetry</li>
<li>each event hub is configured with 100 partitions</li>
<li>data is sent to the event hubs without partition keys</li>
<li>events are serialized using protocol buffers</li>
</ul>
See below for additional details on each of these.
<h3>Batching</h3>
An event hub triggered function can be written to process single messages or batches of messages. The latter has much better performance characteristics. Lets take the splitter function as an example:
<pre>       
public static async Task Run(
  EventData[] sensorEvent,
  PartitionContext partitionContext,
  IAsyncCollector&lt;EventData&gt; outputWeatherData,
  IAsyncCollector&lt;EventData&gt; outputSeismicData,
  TraceWriter log)
  {
    foreach (var sensorData in sensorEvent)
    {
      SensorType sensorType = SensorType.Unknown;

      try
      {                   
        if (sensorData.Properties.ContainsKey("SensorType"))
        {
          System.Enum.TryParse(sensorData.Properties["SensorType"].ToString(), out sensorType);
        }

        await ProcessEvent(sensorData, sensorType, partitionContext, outputWeatherData, outputSeismicData);
      }
      catch(Exception ex)
      {
        telemetryHelper.PostException(ex, sensorData, partitionContext.Lease.PartitionId, sensorType.ToString());
      }
    }                                   
  }
</pre>
The main things to note about this code:
<ul>
<li>An array of events are passed to the function in one execution</li>
<li>An exception handling block wraps the processing of each event</li>
</ul>
The array based approach performs better primarily due to per function execution overhead. The system performs a number of actions when invoking your function and those actions will only happen once for an array of events rather than once per event. Note: for JavaScript functions you'll need to explicitly set the <strong>cardinality</strong> property in your function.json to <strong>many </strong>in order to enable batching (e.g. see <a href="https://github.com/Azure/azure-webjobs-sdk-templates/blob/df94e19484fea88fc2c68d9f032c9d18d860d5b5/Functions.Templates/Templates/EventHubTrigger-JavaScript/function.json#L10">here</a>).

This approach to exception handling is important if you want to ensure you don't lose/skip messages. Typically you'll write your exception handler so that it stores the event that failed for later processing/analysis. This is important because Azure Functions does not have any built in dead lettering for Event Hubs.
<h3>WebJobs Dashboard</h3>
As mentioned above, because we were using App Insights for monitoring we disabled the dashboard. To do this simply go to your application setting and remove the <strong>AzureWebJobsDashboard</strong> setting.
<h3>Partition Configuration</h3>
Azure Functions uses the EventProcessorHost (for more info see <a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-programming-guide#event-consumers">here</a>) provided in the Event Hubs SDK to process event hub messages. The way EventProcessorHost works is that each VM running your app acquires leases to some of the partitions, allowing it to process messages on those partitions. This means that if your event hub has only two partitions, only two VMs can process messages at any given time i.e. the partition count puts an upper limit on the scalability of your function.

The basic and standard tiers for Event Hubs have a default limit of 32 partitions per event hub, but this limit can be increased if you contact <a href="https://portal.azure.com/#create/Microsoft.Support">billing support</a>. By setting the event hubs to have 100 partitions, each function was able to run on 100 VMs simultaneously. We can see this if we look at one minute of telemetry, counting the number of unique VMs that executed the weather function:

<a href="/AppService/media/2017/09/query3.png"><img alt="" class="alignnone size-full wp-image-5906" height="295" src="/AppService/media/2017/09/query3.png" width="461"/></a>

We can get an idea of how evenly the work was distributed over those 94 VMs with another simple query:

<a href="/AppService/media/2017/09/query2.png"><img alt="" class="alignnone size-full wp-image-5895" height="134" src="/AppService/media/2017/09/query2.png" width="390"/></a>
<a href="/AppService/media/2017/09/04-distribution.png"><img alt="" class="alignnone size-full wp-image-5856" height="764" src="/AppService/media/2017/09/04-distribution.png" width="1658"/></a>
<h3>Partition Keys</h3>
The event hubs programming guide has a <a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-programming-guide#partition-key">good summary</a> of partition keys and when you might want to use them. This scenario had no ordering or statefulness requirements so events were generated without partition keys. This increased the overall throughput and availability for the run.
<h3>Protocol Buffers</h3>
If you're writing and reading 100,000+ events a second, you want the serialization and deserialization of those events to be as efficient as possible, both from the perspective of time taken to do the serialization step and also size on the wire. <a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a> is a high performance serialization format that is easy to work with. Here's some example code deserializing and processing a batch of weather readings from an event:
<pre>if (sensorType == SensorType.Weather)
{
  var batch = WeatherReadingBatch.Parser.ParseFrom(sensorData.GetBytes());
  var messages = batch.SensorReadings
    .Select(reading =&gt; EnrichData(enqueuedTime, reading));
  await WriteOutput(messages, sensorData.PartitionKey, outputWeatherData);
}</pre>
If you'd like to see the .proto file used for this scenario see <a href="https://gist.github.com/paulbatum/c918e19cadb43fdfcce978d58d97d235">here</a>.
<h2>Cost</h2>
The total cost of running the function app and its dependencies for the 9 day run was approximately <strong>$1200 USD</strong>. Here's what the cost per hour looks like for each service:
<div style="direction: ltr">
<table border="1" cellpadding="0" cellspacing="0" style="direction: ltr;border-collapse: collapse;border: 1pt solid #A3A3A3" summary="" title="">
<tbody>
<tr>
<td style="vertical-align: top;width: 1.4173in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt"><span style="font-weight: bold">Service</span></p>
</td>
<td style="vertical-align: top;width: 1.409in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt"><span style="font-weight: bold">Cost per Hour (USD)</span></p>
</td>
</tr>
<tr>
<td style="vertical-align: top;width: 1.4173in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">Functions</p>
</td>
<td style="vertical-align: top;width: 1.3395in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">$2.71</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;width: 1.4173in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">Storage</p>
</td>
<td style="vertical-align: top;width: 1.3395in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">$1.80</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;width: 1.4368in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">Application Insights</p>
</td>
<td style="vertical-align: top;width: 1.3201in;padding: 4pt 4pt 4pt 4pt;border: 1pt solid #A3A3A3">
<p style="margin: 0in;font-family: Calibri;font-size: 11.0pt">$1.03</p>
</td>
</tr>
</tbody>
</table>
</div>
A few important points to note:
<ul>
<li>This data does not include the cost of the load generator and Event Hubs as no effort was spent on optimizing these.</li>
<li>The Azure Storage cost is based on approximately 50 million transactions per hour. Almost all of these transactions are related to Event Hubs checkpointing.</li>
<li>The Application Insights cost is based on 450mb of data ingestion per hour.</li>
</ul>
We can dive into function app cost in more detail by using the execution count and execution units data available via the Azure Monitor REST API (see <a href="https://stackoverflow.com/questions/41128329/how-can-i-programmatically-access-azure-functions-usage-metrics">here</a> for more info). Querying for one hour of data, we get the following:
<ul>
<li style="text-align: left">Function Execution Count: 6,500,012</li>
<li>Function Execution Units: 90,305,037,184</li>
</ul>
Note that the function execution units here are measured in mb-milliseconds. To convert these into gb-seconds, divide by 1024000. Putting it altogether (pricing details for functions are <a href="https://azure.microsoft.com/en-us/pricing/details/functions/">here</a>, simple program I wrote to assist is <a href="https://gist.github.com/paulbatum/2b16c5f92351ed1c59e3a2b8a727ca97">here</a>):

Cost per hour = (6,500,012 executions * ( $0.20 / 1,000,000 )) + ((90,305,037,184 units / (1024 * 1000)) * $0.000016) = $2.71 USD
<h2>Summary</h2>
The consumption plan for Azure Functions is capable of scaling your app to run on hundreds of VMs, enabling high performance scenarios without having to reserve and pay for huge amounts of compute capacity up front. To learn more about Azure Functions and building cloud applications on serverless technology, start <a href="https://azure.microsoft.com/en-us/services/functions/">here</a>.</div>
</div></body>
<script src="/AppService/resource/jquery-1.12.1.min.js" type="text/javascript"></script>
<script src="/AppService/resource/replace.js" type="text/javascript"></script>
</html>

        
      </section>

      <footer class="page__meta">
          <p class="page__date"><strong><a href="https://docs.microsoft.com/answers/topics/azure-webapps.html">Post questions</a> | <a href="https://feedback.azure.com/forums/169385-web-apps">Provide product feedback</a></strong></p>
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-09-19T00:00:00+00:00">September 19, 2017</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Processing+100%2C000+Events+Per+Second+on+Azure+Functions%20https%3A%2F%2Fazure.github.io%2FAppService%2F2017%2F09%2F19%2FProcessing-100%2C000-Events-Per-Second-on-Azure-Functions.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fazure.github.io%2FAppService%2F2017%2F09%2F19%2FProcessing-100%2C000-Events-Per-Second-on-Azure-Functions.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fazure.github.io%2FAppService%2F2017%2F09%2F19%2FProcessing-100%2C000-Events-Per-Second-on-Azure-Functions.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/AppService/2017/09/14/Function-Proxies-adds-Mock-APIs-to-the-Portal.html" class="pagination--pager" title="Function Proxies adds Mock APIs to the Portal
">Previous</a>
    
    
      <a href="/AppService/2017/09/25/Develop-Azure-Functions-on-any-platform.html" class="pagination--pager" title="Develop Azure Functions on any platform
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/21/app-service-agent-framework.html" rel="permalink">Build Long-Running AI Agents on Azure App Service with Microsoft Agent Framework
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read

        
        
          • By Jordan Selig
        
        • October 21, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">The AI landscape is evolving rapidly, and with the introduction of Microsoft Agent Framework, developers now have a powerful platform for building sophistica...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/20/dotnet-on-windows.html" rel="permalink">Platform updates for .NET on App Service Windows
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

        
        
          • By Byron Tardif
        
        • October 20, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">
  UPDATE:

  
    Patch deployment has completed on all instances of our HTTP load balancer infrastructure (aka Front Ends).
    Clarified impact to Functio...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/14/Ubuntu-images.html" rel="permalink">Ubuntu-Powered Runtimes on Azure App Service for Linux: Leaner, Faster, Stronger
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

        
        
          • By Tulika Chaudharie
        
        • October 14, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">We’re updating the OS foundation for new code-based stacks on Azure App Service for Linux. Every new major version of our supported stacks will target Ubuntu...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/09/08/Oryx-build-certificate.html" rel="permalink">App Service builds behind proxies: fixing trust with a public certificate
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

        
        
          • By Tulika Chaudharie
        
        • September 8, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">TL;DR: If your organization uses a TLS-inspecting proxy (e.g., Zscaler), some of the traffic originating from App Service build infrastructure may be re-sign...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id">
    <label class="sr-only" for="cse-search-input-box-id">
      Enter your search term...
    </label>
    <input type="search" id="cse-search-input-box-id" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results">
    <gcse:searchresults-only></gcse:searchresults-only>
  </div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  
    <a class="page-microsoft" href="https://www.microsoft.com"><img src="/AppService/media/pages/Microsoft_logo.svg" alt=""></a>
  
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/AzAppService" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/Azure/AppService" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/AppService/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 Azure App Service. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/AppService/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>


<script>
  (function () {
    var cx = '015057007851139702326:ob8gaepprli';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
    $(document).ready(function () {
      $('input#cse-search-input-box-id').on('keyup', function () {
        googleCustomSearchExecute();
      });
    });
  
</script>




  <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-112478220-2']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>









  </body>
</html>
