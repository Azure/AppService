<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Advanced access restriction scenarios in Azure App Service - Azure App Service</title>
<meta name="description" content="Currently, you can use two options when configuring Azure App Service access restrictions. The preview feature provides some new scenarios that you should know.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Azure App Service">
<meta property="og:title" content="Advanced access restriction scenarios in Azure App Service">
<meta property="og:url" content="https://azure.github.io/AppService/2022/11/24/Advanced-access-restriction-scenarios-in-Azure-App-Service.html">


  <meta property="og:description" content="Currently, you can use two options when configuring Azure App Service access restrictions. The preview feature provides some new scenarios that you should know.">



  <meta property="og:image" content="https://azure.github.io/AppService/assets/images/icon.png">





  <meta property="article:published_time" content="2022-11-24T00:00:00+00:00">





  

  


<link rel="canonical" href="https://azure.github.io/AppService/2022/11/24/Advanced-access-restriction-scenarios-in-Azure-App-Service.html">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://azure.github.io/AppService",
      "logo": "https://azure.github.io/AppService/assets/images/icon.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Azure App Service",
      "url": "https://azure.github.io/AppService",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/AppService/feed.xml" type="application/atom+xml" rel="alternate" title="Azure App Service Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/AppService/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->

<!-- Jekyll env: production -->



    <!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" 
      type="image/png" 
      href="/AppService/media/pages/new_app_service_logo_16.png">
<link rel="shortcut icon" 
      type="image/png" 
      href="/AppService/media/pages/new_app_service_logo_16.png">

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/AppService/"><img src="/AppService/media/pages/new_app_service_logo_64.svg" alt=""></a>
        
        <a class="site-title" href="/AppService/">
          Azure App Service
          <span class="site-subtitle">Team Blog</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/AppService/tags/" >Tags</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/AppService/"><span class="nav__sub-title">Home</span></a>
        

        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Product Areas</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="/AppService/networking/" class="">Networking & ASE</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/java/" class="">Java</a>
              
                
                
                
                
    
                
                
                <ul>
                  <li style="padding-left: 6px;"><a href="/AppService/java/videos/" class="">Videos</a></li>
                </ul>
                
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/diagnostics/" class="">Diagnostics</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/certsdomains/" class="">Certs and Domains</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/deployment/" class="">Deployment, CI/CD, Slots</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/windows-containers/" class="">Windows Containers</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/sidecars/" class="">Sidecars</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/ai-integration/" class="">AI Integration</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Reference</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="https://docs.microsoft.com/azure/app-service/" class="">Documentation</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://github.com/Azure/app-service-linux-docs" class="">Linux FAQ</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://aka.ms/appservicewindowscontainerwiki" class="">Windows Containers Wiki</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/zero-to-hero/" class="">Zero to Hero tutorials</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">More</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="https://twitter.com/Azure" class="">Twitter</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/feed.xml" class="">RSS Feed</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://azure.microsoft.com/blog/" class="">Azure Blog</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://azure.microsoft.com/updates/" class="">Azure Updates</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Archives</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="/AppService/2020" class="">2020</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2019" class="">2019</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2018" class="">2018</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2017" class="">2017</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2016" class="">2016</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/posts/" class="">All posts</a>
              
            </li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Advanced access restriction scenarios in Azure App Service">
    <meta itemprop="description" content="Currently, you can use two options when configuring Azure App Service access restrictions. The preview feature provides some new scenarios that you should know.">
    <meta itemprop="datePublished" content="November 24, 2022">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Advanced access restriction scenarios in Azure App Service
</h1>
          <p class="page__meta">
            
              <i class="far fa-clock" aria-hidden="true"></i> 




  15 minute read

            
            
              • By Błażej Miśkiewicz
            
            • November 24, 2022
          </p>
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#access-restriction-advanced-scenarios">Access restriction advanced scenarios:</a></li>
  <li><a href="#getting-started">Getting Started</a></li>
  <li><a href="#create-basic-infrastructure">Create basic infrastructure</a></li>
  <li><a href="#first-advanced-scenario---filter-by-http-header">First advanced scenario - Filter by http header</a></li>
  <li><a href="#second-advanced-scenario---multi-source-rules">Second advanced scenario - Multi-source rules</a></li>
  <li><a href="#third-advanced-scenario---block-a-single-ip-address">Third advanced scenario - Block a single IP address</a></li>
  <li><a href="#fourth-advanced-scenario---restrict-access-to-the-scm-site">Fourth advanced scenario - Restrict access to the SCM site</a></li>
</ul>
            </nav>
          </aside>
        
        <h2 id="introduction">Introduction</h2>

<p>Currently, you can use two options when configuring Azure App Service access restrictions. The preview feature provides some new scenarios that you should know.</p>

<p>This article will walk you through building a demo environment where you will test advanced access restriction scenarios in Azure App Service.</p>

<p><img src="/AppService/media/2022/11/access_restriction.png" alt="Access restriction" class="align-center" /></p>

<h2 id="access-restriction-advanced-scenarios">Access restriction advanced scenarios:</h2>

<ol>
  <li>Filter by http header</li>
  <li>Multi-source rules</li>
  <li>Block a single IP address</li>
  <li>Restrict access to the SCM site</li>
</ol>

<p>For more information about <em>App Service access restrictions</em>, visit <a href="https://learn.microsoft.com/azure/app-service/app-service-ip-restrictions">this page</a></p>

<p><strong>Requirements:</strong></p>

<p>Access to an Azure subscription.</p>

<p><strong>Decide where you will execute commands</strong></p>

<p>The best option to walk through this guide and execute commands would be using Azure Cloud Shell with Bash environment. Azure Cloud Shell is an interactive, authenticated, browser-accessible shell for managing Azure resources. It provides the flexibility of choosing the shell experience that best suits the way you work, either Bash or PowerShell. For information on how to use Azure Cloud Shell, visit <a href="https://docs.microsoft.com/azure/cloud-shell/overview">Azure Cloud Shell</a>. You can also install Azure CLI on your machine. The Azure CLI is available to install in Windows, macOS and Linux environments. It can also be run in a Docker container and Azure Cloud Shell. For information on how to install the Azure CLI, please visit <a href="https://docs.microsoft.com/cli/azure/install-azure-cli">Azure CLI installation</a>.</p>

<p>If you decide to use <a href="https://shell.azure.com">Azure Cloud Shell</a>, please use Bash environment.</p>

<h2 id="getting-started">Getting Started</h2>

<p><strong>Create folder for your data</strong></p>

<p>You can use the name below for your folder. You just need to replace <em>ardemo</em> with your environment name.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>ardemo
<span class="nb">cd </span>ardemo
</code></pre></div></div>

<p><strong>Choosing the right subscription</strong></p>

<p>If you have many subscriptions, you must select the subscription to which you want to deploy the resources.</p>

<p>Using this command you can find and copy the <em>SubscriptionId</em> on which you want to create resources for this scenario.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az account list <span class="nt">-o</span> table
</code></pre></div></div>

<p>Using this command you can set a subscription to be the current active subscription.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az account <span class="nb">set</span> <span class="nt">-s</span> YourSubscriptionID
</code></pre></div></div>

<p>You can find more information about <em>az account</em> command on this site <a href="https://docs.microsoft.com/cli/azure/account?view=azure-cli-latest">az account</a>.</p>

<p><strong>Prepare parameters</strong></p>

<p>When you construct your naming convention, identify the key pieces of information that you want to reflect in the resource names. Different information is relevant for different resource types. The following sites are useful when you construct resource names - <a href="https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/resource-naming">Define your naming convention</a> and <a href="https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/resource-abbreviations">Recommended abbreviations for Azure resource types</a>.</p>

<p>You can use the names below. You just need to replace <em>ardemo</em> with your environment name and change <em>LocationRegion</em> parameter.</p>

<p>Please copy and paste your parameters to your shell.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">LocationRegion</span><span class="o">=</span>westeurope
<span class="nv">ResourceGroupName</span><span class="o">=</span>rg-ardemo
<span class="nv">WebAppName</span><span class="o">=</span>app-ardemo-prod-01
<span class="nv">AppServicePlanName</span><span class="o">=</span>asp-ardemo-linux-prod-01
<span class="nv">VirtualNetworkName</span><span class="o">=</span>vnet-ardemo-prod-westeurope-01
<span class="nv">SubnetNameVnet</span><span class="o">=</span>snet-ardemo-prod-westeurope-01
<span class="nv">VnetPrefix</span><span class="o">=</span>192.168.10.0/24
<span class="nv">SubnetVnetPrefix</span><span class="o">=</span>192.168.10.0/25
<span class="nv">PrivateEndpointName</span><span class="o">=</span>pep-ardemo-prod-01
<span class="nv">PrivateEndpointConnectionName</span><span class="o">=</span>con-pep-ardemo-prod-01
<span class="nv">FDName</span><span class="o">=</span>fd-ardemo-01
<span class="nv">OriginGroup</span><span class="o">=</span>origin-group-ardemo
<span class="nv">OriginNamePrimary</span><span class="o">=</span>primary
<span class="nv">LogAnalyticsName</span><span class="o">=</span>log-ardemo-01
<span class="nv">ApplicationInsightsName</span><span class="o">=</span>appi-ardemo-01
<span class="nv">ApplicationInsightsWebTestName</span><span class="o">=</span>WebsiteTest-<span class="nv">$WebAppName</span>
</code></pre></div></div>

<h2 id="create-basic-infrastructure">Create basic infrastructure</h2>

<p><strong>Create Resource Groups</strong></p>

<p>The demo environment will be organized using one resource group.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az group create <span class="nt">-l</span> <span class="nv">$LocationRegion</span> <span class="nt">-n</span> <span class="nv">$ResourceGroupName</span>
</code></pre></div></div>

<p><strong>Create virtual network with subnet for App Service Private Endpoint</strong></p>

<p>A virtual network will be required for <em>Azure App Service Private Endpoint</em>. This command will create a virtual network with a subnet.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az network vnet create <span class="nt">-g</span> <span class="nv">$ResourceGroupName</span> <span class="nt">-n</span> <span class="nv">$VirtualNetworkName</span> <span class="nt">--address-prefix</span> <span class="nv">$VnetPrefix</span> <span class="nt">--subnet-name</span> <span class="nv">$SubnetNameVnet</span> <span class="nt">--subnet-prefix</span> <span class="nv">$SubnetVnetPrefix</span>
</code></pre></div></div>

<p><strong>Create an App Service Plan</strong></p>

<p>An App Service plan defines a set of compute resources for a web app to run.</p>

<p>For more information about <em>Azure App Service plan</em>, visit <a href="https://learn.microsoft.com/azure/app-service/overview-hosting-plans">this page</a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az appservice plan create <span class="nt">-n</span> <span class="nv">$AppServicePlanName</span> <span class="nt">-g</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--location</span> <span class="nv">$LocationRegion</span> <span class="nt">--sku</span> P1V2 <span class="nt">--is-linux</span> <span class="nt">--number-of-workers</span> 1
</code></pre></div></div>

<p><strong>Create a Web App</strong></p>

<p>To create a PHP app in your <em>App Service plan</em> please use this command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp create <span class="nt">-n</span> <span class="nv">$WebAppName</span> <span class="nt">-g</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--plan</span> <span class="nv">$AppServicePlanName</span> <span class="nt">--runtime</span> <span class="s2">"PHP:8.0"</span>
</code></pre></div></div>

<p>Create a variable with the URL of your website. You will use this variable later with <em>curl</em> command to check if your webapp is working correctly.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">URLofYourWebsite</span><span class="o">=</span><span class="si">$(</span>az webapp show <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--query</span> defaultHostName <span class="nt">-o</span> tsv<span class="si">)</span>
</code></pre></div></div>

<p><strong>Create index.php file for your web app</strong></p>

<p>Sample code for your web app:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'&lt;?php
 echo "Azure App Service access restrictions demo";
?&gt;'</span> <span class="o">&gt;</span> index.php
</code></pre></div></div>

<p><strong>Create zip file for your web app code</strong></p>

<p>In the next step you will use <em>ZIP Deploy</em> to deploy the application. You need a ZIP utility for this. If you’re using Azure Cloud Shell, ZIP utility is pre-installed and already available.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zip YourWebSite.zip index.php
</code></pre></div></div>

<p><strong>Deploy sample app</strong></p>

<p>To deploy a sample application using <em>ZIP Deploy</em>, use this command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp deployment <span class="nb">source </span>config-zip <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span>  <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--src</span> ./YourWebSite.zip
</code></pre></div></div>

<p><strong>Check if your app is running</strong></p>

<p>Use your browser or use <em>curl</em> command to check if your app is working correctly.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://<span class="nv">$URLofYourWebsite</span>
</code></pre></div></div>

<p><strong>Create the Private Endpoint</strong></p>

<p>A private endpoint is a network interface that uses a private IP address from your virtual network. This network interface connects you privately and securely to a service that’s powered by Azure Private Link. By enabling a private endpoint, you’re bringing the service into your virtual network.</p>

<p>For more information about <em>private endpoint</em>, visit <a href="https://learn.microsoft.com/azure/private-link/private-endpoint-overview">this page</a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">id</span><span class="o">=</span><span class="si">$(</span>az webapp show <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--query</span> <span class="s1">'[id]'</span> <span class="nt">--output</span> tsv<span class="si">)</span>
az network private-endpoint create <span class="nt">-n</span> <span class="nv">$PrivateEndpointName</span> <span class="nt">-g</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--vnet-name</span> <span class="nv">$VirtualNetworkName</span> <span class="nt">--subnet</span> <span class="nv">$SubnetNameVnet</span> <span class="nt">--connection-name</span> <span class="nv">$PrivateEndpointConnectionName</span> <span class="nt">--private-connection-resource-id</span> <span class="nv">$id</span> <span class="nt">--group-id</span> sites
</code></pre></div></div>

<p><strong>Configure the private DNS zone</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az network private-dns zone create <span class="nt">--name</span> privatelink.azurewebsites.net <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span>
az network private-dns <span class="nb">link </span>vnet create <span class="nt">--name</span> myDNSLink <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--registration-enabled</span> <span class="nb">false</span> <span class="nt">--virtual-network</span> <span class="nv">$VirtualNetworkName</span> <span class="nt">--zone-name</span> privatelink.azurewebsites.net
az network private-endpoint dns-zone-group create <span class="nt">--name</span> myZoneGroup <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--endpoint-name</span> <span class="nv">$PrivateEndpointName</span> <span class="nt">--private-dns-zone</span> privatelink.azurewebsites.net <span class="nt">--zone-name</span> privatelink.azurewebsites.net
</code></pre></div></div>

<p><strong>Check if your website is unavailable</strong></p>

<p>After enabling private endpoint, the web app should not be reachable from the Internet.</p>

<p>Use your browser or use <em>curl</em> command to check if your app is not reachable.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://<span class="nv">$URLofYourWebsite</span>
</code></pre></div></div>

<p>The result should look similar to this.</p>

<p><img src="/AppService/media/2022/11/curl_site_403.png" alt="Forbidden" class="align-center" /></p>

<p><strong>Optional test</strong></p>

<p>You can create a VM in the same virtual network as the private endpoint for Azure App Service and run a network connection test using private IP address. The name of the Azure App Service should resolve to a private IP address. You can check this using the <em>ping</em> or <em>nslookup</em> command. To check if the website is working properly by using the private IP address, use <em>curl</em> command or a browser on a VM that you will deploy.</p>

<blockquote>
  <p><strong>Remember</strong> to use the standard App Service URL. Thanks to the integration with private DNS zone, the name will be translated into a private IP address.
For more information about <em>Azure App Service private endpoint DNS</em>, visit <a href="https://learn.microsoft.com/azure/app-service/networking/private-endpoint#dns">this page</a>.</p>
</blockquote>

<h2 id="first-advanced-scenario---filter-by-http-header">First advanced scenario - Filter by http header</h2>

<p>Currently, you can run Azure App Service with a private endpoint as well as allow traffic from the Internet to Azure App Service. Thanks to this, you can use, for example, Azure Front Door Standard SKU to make Azure App Service available from the Internet. Previously, when using a private endpoint for Azure App Service, it was required to use the Azure Front Door Premium SKU.</p>

<p>For more information about <em>Secure Origin with Private Link in Azure Front Door Premium</em>, visit <a href="https://learn.microsoft.com/azure/frontdoor/private-link">this page</a>.</p>

<p>In this guide you will add a <em>rule</em> that will allow access from Azure Front Door Standard instance to your Azure App Service using <em>X-Azure-FDID</em>.</p>

<blockquote>
  <p><strong>Tip</strong> Access restrictions can use the following headers:</p>
  <ol>
    <li>X-Forwarded-Host - You can specify hostnames of the originating request to limit traffic if a load balancer or HTTP proxy supports hostname forwarding. Enter up to 8 hostnames separated by a comma.</li>
    <li>X-Forwarded-For - You can specify IP addresses of the originating client if a load balancer or HTTP proxy supports IP forwarding when the traffic is passing &gt;through. Enter up to 8 CIDR addresses separated by a comma.</li>
    <li>X-Azure-FDID - You can specify a unique instance id of Azure Front Door or reverse proxies supporting unique header identification. Enter up to 8 ids &gt;separated by a comma.</li>
    <li>X-FD-HealthProbe - You can specify health probe identification to allow probe traffic. Enter up to 8 health probe ids separated by a comma.</li>
  </ol>
</blockquote>

<p><strong>Enable public access</strong></p>

<p>To allow traffic from the Internet, use this command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az resource update <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--resource-type</span> <span class="s2">"Microsoft.Web/sites"</span> <span class="nt">--set</span> properties.publicNetworkAccess<span class="o">=</span>Enabled
</code></pre></div></div>

<p>You can also enable <em>Allow public access</em> from the GUI.</p>

<p><img src="/AppService/media/2022/11/access_restrictions_allow_public_access.png" alt="Allow public access" class="align-center" /></p>

<p><strong>Check if your website is available</strong></p>

<p>After enabling public access, the webapp should be available from the Internet and from the private endpoint.</p>

<p>Use your browser or <em>curl</em> command to check if your app is working correctly.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://<span class="nv">$URLofYourWebsite</span>
</code></pre></div></div>

<p><strong>Secure Access using Front Door Standard SKU</strong></p>

<p>Azure Front Door is Microsoft’s modern cloud Content Delivery Network (CDN) that provides fast, reliable, and secure access between your users and your applications’ static and dynamic web content across the globe. Azure Front Door delivers your content using the Microsoft’s global edge network with hundreds of global and local POPs distributed around the world close to both your enterprise and consumer end users.</p>

<p>For more information about <em>Azure Front Door</em>, visit <a href="https://learn.microsoft.com/azure/frontdoor/front-door-overview">this page</a>.</p>

<p><strong>Create Azure Front Door profile</strong></p>

<p>Run <code class="language-plaintext highlighter-rouge">az afd profile create</code> to create an Azure Front Door profile.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az afd profile create <span class="se">\</span>
    <span class="nt">--profile-name</span> <span class="nv">$FDName</span> <span class="se">\</span>
    <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="se">\</span>
    <span class="nt">--sku</span> Standard_AzureFrontDoor
</code></pre></div></div>

<p><strong>Add an endpoint</strong></p>

<p>Run <code class="language-plaintext highlighter-rouge">az afd endpoint create</code> to create an endpoint in your profile.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az afd endpoint create <span class="se">\</span>
    <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="se">\</span>
    <span class="nt">--endpoint-name</span> endpoint-<span class="nv">$FDName</span> <span class="se">\</span>
    <span class="nt">--profile-name</span> <span class="nv">$FDName</span> <span class="se">\</span>
    <span class="nt">--enabled-state</span> Enabled
</code></pre></div></div>

<p>Create a variable with the URL of your Azure Front Door endpoint. You will use this variable later with the <em>curl</em> command to check if your Azure Front Door endpoint is working correctly.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">URLofYourFrontDoorEndpoint</span><span class="o">=</span><span class="si">$(</span>az afd endpoint show <span class="se">\</span>
    <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="se">\</span>
    <span class="nt">--profile-name</span> <span class="nv">$FDName</span> <span class="se">\</span>
    <span class="nt">--endpoint-name</span> endpoint-<span class="nv">$FDName</span> <span class="se">\</span>
    <span class="nt">--query</span> hostName <span class="nt">-o</span> tsv<span class="si">)</span>
</code></pre></div></div>

<p>You can also write down the URL of your Azure Front Door endpoint.</p>

<p><img src="/AppService/media/2022/10/url-front-door.png" alt="URL of your site" class="align-center" /></p>

<p><strong>Create an origin group</strong></p>

<p>Run <code class="language-plaintext highlighter-rouge">az afd origin-group create</code> to create an origin group that contains your web apps.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az afd origin-group create <span class="se">\</span>
    <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="se">\</span>
    <span class="nt">--origin-group-name</span> <span class="nv">$OriginGroup</span> <span class="se">\</span>
    <span class="nt">--profile-name</span> <span class="nv">$FDName</span> <span class="se">\</span>
    <span class="nt">--probe-request-type</span> GET <span class="se">\</span>
    <span class="nt">--probe-protocol</span> Https <span class="se">\</span>
    <span class="nt">--probe-interval-in-seconds</span> 60 <span class="se">\</span>
    <span class="nt">--probe-path</span> / <span class="se">\</span>
    <span class="nt">--sample-size</span> 4 <span class="se">\</span>
    <span class="nt">--successful-samples-required</span> 3 <span class="se">\</span>
    <span class="nt">--additional-latency-in-milliseconds</span> 50
</code></pre></div></div>

<p><strong>Add an origin to the group - primary website</strong></p>

<p>Run <code class="language-plaintext highlighter-rouge">az afd origin create</code> to add an origin to your origin group.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az afd origin create <span class="se">\</span>
    <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="se">\</span>
    <span class="nt">--host-name</span> <span class="nv">$URLofYourWebsite</span> <span class="se">\</span>
    <span class="nt">--profile-name</span> <span class="nv">$FDName</span> <span class="se">\</span>
    <span class="nt">--origin-group-name</span> <span class="nv">$OriginGroup</span> <span class="se">\</span>
    <span class="nt">--origin-name</span> <span class="nv">$OriginNamePrimary</span> <span class="se">\</span>
    <span class="nt">--origin-host-header</span> <span class="nv">$URLofYourWebsite</span> <span class="se">\</span>
    <span class="nt">--priority</span> 1 <span class="se">\</span>
    <span class="nt">--weight</span> 1000 <span class="se">\</span>
    <span class="nt">--enabled-state</span> Enabled <span class="se">\</span>
    <span class="nt">--http-port</span> 80 <span class="se">\</span>
    <span class="nt">--https-port</span> 443
</code></pre></div></div>

<p><strong>Add a route</strong></p>

<p>Run <code class="language-plaintext highlighter-rouge">az afd route create</code> to map your endpoint to the origin group. This route forwards requests from the endpoint to your origin group.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az afd route create <span class="se">\</span>
    <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span>  <span class="se">\</span>
    <span class="nt">--profile-name</span> <span class="nv">$FDName</span> <span class="se">\</span>
    <span class="nt">--endpoint-name</span> endpoint-<span class="nv">$FDName</span> <span class="se">\</span>
    <span class="nt">--forwarding-protocol</span> MatchRequest <span class="se">\</span>
    <span class="nt">--route-name</span> route <span class="se">\</span>
    <span class="nt">--https-redirect</span> Enabled <span class="se">\</span>
    <span class="nt">--origin-group</span> <span class="nv">$OriginGroup</span> <span class="se">\</span>
    <span class="nt">--supported-protocols</span> Http Https <span class="se">\</span>
    <span class="nt">--link-to-default-domain</span> Enabled
</code></pre></div></div>

<p>For more information about Azure CLI for Azure Front Door, visit <a href="https://learn.microsoft.com/azure/frontdoor/create-front-door-cli">Front Door CLI</a>.</p>

<p>In a production environment you will probably need to implement a WAF policy for you application. For more information about Azure CLI for Azure Front Door WAF Policy, visit <a href="https://learn.microsoft.com/azure/frontdoor/create-front-door-cli#create-a-new-security-policy">Front Door WAF Policy</a>.</p>

<p><strong>Check if your Azure Front Door Endpoint is running - this process may take a while</strong></p>

<p>Use your browser or <em>curl</em> command to check if your app is working correctly. It may take 10-15 minutes for your app to be accessible using Front Door.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://<span class="nv">$URLofYourFrontDoorEndpoint</span>
</code></pre></div></div>

<p><strong>Add X-Azure-FDID rule</strong></p>

<p>Create a variable with the ID of your Azure Front Door profile.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">YourFrontDoorID</span><span class="o">=</span><span class="si">$(</span>az afd profile show <span class="se">\</span>
    <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="se">\</span>
    <span class="nt">--profile-name</span> <span class="nv">$FDName</span> <span class="se">\</span>
    <span class="nt">--query</span> frontDoorId <span class="nt">-o</span> tsv<span class="si">)</span>
</code></pre></div></div>

<p>Add a rule that only allows communication from the specific Azure Front Door profile.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp config access-restriction add <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--rule-name</span> FrontDoor <span class="nt">--action</span> Allow <span class="nt">--priority</span> 100 <span class="nt">--service-tag</span> AzureFrontDoor.Backend <span class="nt">--http-header</span> x-azure-fdid<span class="o">=</span><span class="nv">$YourFrontDoorID</span>
</code></pre></div></div>

<p><strong>Check if your app allow connections using Azure Front Door URL</strong></p>

<p>Use your browser or <em>curl</em> command to check if your app is working correctly using Azure Front Door URL.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://<span class="nv">$URLofYourFrontDoorEndpoint</span>
</code></pre></div></div>

<p><strong>Check if your app is blocked by network restrictions</strong></p>

<p>Use your browser or <em>curl</em> command to check if your app is not available via direct URL access.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://<span class="nv">$URLofYourWebsite</span>
</code></pre></div></div>

<h2 id="second-advanced-scenario---multi-source-rules">Second advanced scenario - Multi-source rules</h2>

<p>Multi-source rules allow you to combine up to eight IP ranges or eight Service Tags in a single rule. You might use this if you have more than 512 IP ranges or you want to create logical rules where multiple IP ranges are combined with a single http header filter.</p>

<p><strong>First example - add multiple ip ranges to rule</strong></p>

<p>In example 1, you will add several ip ranges to one rule.</p>

<p><strong>Prepare to run the first scenario</strong></p>

<p>To remove the policy from the previous scenario, please run the command below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp config access-restriction remove <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--rule-name</span> FrontDoor
</code></pre></div></div>

<p>To change the default behavior <em>Unmatched rule action</em> to <em>Deny</em>, please run the command below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az resource update <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--resource-type</span> <span class="s2">"Microsoft.Web/sites"</span> <span class="nt">--set</span> properties.siteConfig.ipSecurityRestrictionsDefaultAction<span class="o">=</span>Deny
</code></pre></div></div>

<p><strong>Check if your app is blocked by network restrictions</strong></p>

<p>Use your browser or <em>curl</em> command to check if your app is blocked by network restrictions.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://<span class="nv">$URLofYourWebsite</span>
</code></pre></div></div>

<p><strong>Check your public IP addresses and create variable</strong></p>

<blockquote>
  <p><strong>Remember</strong> If you are using Azure Cloud Shell, remember that you will have a different public IP address every time you restart your console.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">YourPublicIPaddress</span><span class="o">=</span><span class="si">$(</span>curl icanhazip.com<span class="si">)</span>
</code></pre></div></div>

<blockquote>
  <p><strong>TIP</strong> You can also use a Powershell command to check your public IP address.</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>Invoke-WebRequest <span class="nt">-uri</span> <span class="s2">"http://ifconfig.me/ip"</span><span class="o">)</span>.Content
</code></pre></div>  </div>

  <p>or you can use curl command</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>curl icanhazip.com<span class="o">)</span>.Content
</code></pre></div>  </div>
</blockquote>

<p><strong>Add IP addresses to multi-source rule</strong></p>

<p>To add a rule that will block traffic from several IP ranges, run the below command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp config access-restriction add <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--rule-name</span> AllowBranchWarsawIPaddresses <span class="nt">--action</span> Allow <span class="nt">--priority</span> 200 <span class="nt">--ip-address</span> 192.168.1.0/24,192.168.10.0/24,192.168.100.0/24,<span class="nv">$YourPublicIPaddress</span>
</code></pre></div></div>

<p><strong>Check if your app allows connections</strong></p>

<p>Use your browser or <em>curl</em> command to check if your app is working correctly.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://<span class="nv">$URLofYourWebsite</span>
</code></pre></div></div>

<p><strong>Second example - add multiple service tags to a network restriction rule</strong></p>

<p>This example show you how you can add multiple service tags to a network restriction rule. In this example we will allow connections from Logic Apps, Application Insights and API Management from West Europe. In this example you will test this rule using Application Insights availability test.</p>

<p><strong>Prepare to run the second example</strong></p>

<p>The following command will create <em>Application Insights</em> and <em>Log Analytics Workspace</em> for you.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az monitor log-analytics workspace create <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--workspace-name</span> <span class="nv">$LogAnalyticsName</span>
<span class="nv">LogAnalyticsId</span><span class="o">=</span><span class="si">$(</span>az monitor log-analytics workspace show <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--workspace-name</span> <span class="nv">$LogAnalyticsName</span> <span class="nt">--query</span> <span class="nb">id</span> <span class="nt">-o</span> tsv<span class="si">)</span>
<span class="nv">LogAnalyticsWorkspaceId</span><span class="o">=</span><span class="si">$(</span>az monitor log-analytics workspace show <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--workspace-name</span> <span class="nv">$LogAnalyticsName</span> <span class="nt">--query</span> customerId <span class="nt">-o</span> tsv<span class="si">)</span>
az monitor app-insights component create <span class="nt">--app</span> <span class="nv">$ApplicationInsightsName</span> <span class="nt">--location</span> <span class="nv">$LocationRegion</span> <span class="nt">--kind</span> web <span class="nt">-g</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--application-type</span> web <span class="nt">--workspace</span> <span class="nv">$LogAnalyticsId</span>
<span class="nv">ApplicationInsightId</span><span class="o">=</span><span class="si">$(</span>az monitor app-insights component show <span class="nt">--app</span> <span class="nv">$ApplicationInsightsName</span> <span class="nt">-g</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--query</span> <span class="nb">id</span> <span class="nt">-o</span> tsv<span class="si">)</span>
az monitor app-insights web-test create <span class="nt">--web-test-kind</span> <span class="s2">"standard"</span> <span class="nt">--enabled</span> <span class="nb">true</span> <span class="nt">--location</span> <span class="nv">$LocationRegion</span> <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$ApplicationInsightsWebTestName</span> <span class="nt">--defined-web-test-name</span> <span class="nv">$ApplicationInsightsWebTestName</span> <span class="nt">--tags</span> <span class="s2">"hidden-link:</span><span class="nv">$ApplicationInsightId</span><span class="s2">=Resource"</span> <span class="nt">--http-verb</span> <span class="s2">"GET"</span> <span class="nt">--request-url</span> <span class="s2">"https://</span><span class="nv">$URLofYourWebsite</span><span class="s2">"</span> <span class="nt">--timeout</span> 30 <span class="nt">--frequency</span> 300 <span class="nt">--retry-enabled</span> <span class="nb">true</span> <span class="nt">--locations</span> <span class="nv">Id</span><span class="o">=</span><span class="s2">"emea-nl-ams-azr"</span> <span class="nt">--locations</span> <span class="nv">Id</span><span class="o">=</span><span class="s2">"us-fl-mia-edge"</span>
</code></pre></div></div>

<p><strong>Show Application Insights availability test result</strong></p>

<p>After running the command below, you should get a result from <em>Application Insights</em> that the tests failed.</p>

<blockquote>
  <p><strong>Tip</strong> Please wait 5-10 minutes before you run this command. Availability tests are run every 5 minutes.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az monitor log-analytics query <span class="nt">-w</span> <span class="nv">$LogAnalyticsWorkspaceId</span> <span class="nt">--analytics-query</span> <span class="s2">"AppAvailabilityResults | project TimeGenerated, Message, Location | order by TimeGenerated desc"</span> <span class="nt">-t</span> P0DT1H <span class="nt">-o</span> table
</code></pre></div></div>
<blockquote>
  <p><strong>Tip</strong> If you have multiple availability tests in one <em>Application Insight</em>, you can use the <em>Name</em> field for filtering.</p>
</blockquote>

<p>The result should look similar to this.</p>

<p><img src="/AppService/media/2022/11/403-ip-forbidden.png" alt="403-ip-forbidden" class="align-center" /></p>

<p><strong>Add service tags to multi-source rule</strong></p>

<p>To add a rule that will allow traffic from several service tags, run the following command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp config access-restriction add <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--rule-name</span> AllowMultipleServiceTags <span class="nt">--action</span> Allow <span class="nt">--priority</span> 300 <span class="nt">--service-tag</span> LogicApps,ApiManagement.WestEurope,ApplicationInsightsAvailability
</code></pre></div></div>

<p><strong>Show Application Insight availability test result</strong></p>

<p>After running the command below, you should get a result from <em>Application Insight</em> that the tests passed.</p>

<blockquote>
  <p><strong>Tip</strong> Please wait 5-10 minutes before you run this command. Availability tests are run every 5 minutes.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az monitor log-analytics query <span class="nt">-w</span> <span class="nv">$LogAnalyticsWorkspaceId</span> <span class="nt">--analytics-query</span> <span class="s2">"AppAvailabilityResults | project TimeGenerated, Message, Location | order by TimeGenerated desc"</span> <span class="nt">-t</span> P0DT1H <span class="nt">-o</span> table
</code></pre></div></div>

<p>The result should look similar to this.</p>

<p><img src="/AppService/media/2022/11/passed.png" alt="Passed" class="align-center" /></p>

<h2 id="third-advanced-scenario---block-a-single-ip-address">Third advanced scenario - Block a single IP address</h2>

<p><strong>Remove previous rules</strong></p>

<p>To remove the rules from the previous scenario, run the command below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp config access-restriction remove <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--rule-name</span> AllowBranchWarsawIPaddresses
az webapp config access-restriction remove <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--rule-name</span> AllowMultipleServiceTags
</code></pre></div></div>

<p><strong>Change default behavior for <em>Unmatched rule action</em> to <em>Allow</em></strong></p>

<p>To change the default behavior to <em>Allow</em>, run the command below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az resource update <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--resource-type</span> <span class="s2">"Microsoft.Web/sites"</span> <span class="nt">--set</span> properties.siteConfig.ipSecurityRestrictionsDefaultAction<span class="o">=</span>Allow
</code></pre></div></div>

<p><strong>Check if your app allow connections</strong></p>

<p>Use your browser or <em>curl</em> command to check if your app allows connections.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://<span class="nv">$URLofYourWebsite</span>
</code></pre></div></div>

<p><strong>Block your public IP address</strong></p>

<p>To add a rule that will block traffic from your IP address, run the command below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp config access-restriction add <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--rule-name</span> BlockSingleIpAddress <span class="nt">--action</span> Deny <span class="nt">--priority</span> 200 <span class="nt">--ip-address</span> <span class="nv">$YourPublicIPaddress</span>
</code></pre></div></div>

<p><strong>Check if your app is blocked by network restrictions</strong></p>

<p>Use your browser or <em>curl</em> command to check if your app is blocked by network restriction.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://<span class="nv">$URLofYourWebsite</span>
</code></pre></div></div>

<h2 id="fourth-advanced-scenario---restrict-access-to-the-scm-site">Fourth advanced scenario - Restrict access to the SCM site</h2>

<p>You can use the same access restriction rules from the <em>Main site</em> or create your own rule for the SCM (Advanced tool) site. The SCM site is responsible for <em>Web Deploy</em> and <em>Kudu console</em>.</p>

<p>For more information about <em>Kudu</em>, visit <a href="https://learn.microsoft.com/azure/app-service/resources-kudu">Kudu service overview</a>.</p>

<p><strong>Verify that you can deploy your sample app</strong></p>

<p>To verify that you can deploy your sample app via <em>Web Deploy</em>, run the command below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp deployment <span class="nb">source </span>config-zip <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span>  <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--src</span> ./YourWebSite.zip
</code></pre></div></div>

<p><strong>Use the same access restrictions rules from <em>Main site</em> in <em>Advanced tool site</em></strong></p>

<p>To use the same rules from the <em>Main site</em> in the <em>Advanced tool site</em>, run this command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp config access-restriction <span class="nb">set</span> <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span>  <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--use-same-restrictions-for-scm-site</span> <span class="nb">true</span>
</code></pre></div></div>

<p><strong>Verify that you can’t deploy your sample app</strong></p>

<p>To verify that you can’t deploy your sample app via <em>Web Deploy</em>, please run the command below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp deployment <span class="nb">source </span>config-zip <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span>  <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--src</span> ./YourWebSite.zip
</code></pre></div></div>

<p><strong>Configure different rules for Advanced tool site</strong></p>

<p>To configure other rules for <em>Advanced tool site</em>, run below command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp config access-restriction <span class="nb">set</span> <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span>  <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--use-same-restrictions-for-scm-site</span> <span class="nb">false</span>
</code></pre></div></div>

<p>To add a rule that will allow traffic from your IP address to the <em>SCM</em> site, run the bellow command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp config access-restriction add <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span> <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--rule-name</span> BlockSingleIpAddress <span class="nt">--action</span> Allow <span class="nt">--scm-site</span> <span class="nb">true</span> <span class="nt">--priority</span> 200 <span class="nt">--ip-address</span> <span class="nv">$YourPublicIPaddress</span>
</code></pre></div></div>

<p><strong>Verify that you can deploy your sample app</strong></p>

<p>To verify that you can deploy your sample app via <em>Web Deploy</em>, please run the command below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az webapp deployment <span class="nb">source </span>config-zip <span class="nt">--resource-group</span> <span class="nv">$ResourceGroupName</span>  <span class="nt">--name</span> <span class="nv">$WebAppName</span> <span class="nt">--src</span> ./YourWebSite.zip
</code></pre></div></div>

<p>You successfully completed the article.</p>

        
      </section>

      <footer class="page__meta">
          <p class="page__date"><strong><a href="https://docs.microsoft.com/answers/topics/azure-webapps.html">Post questions</a> | <a href="https://feedback.azure.com/forums/169385-web-apps">Provide product feedback</a></strong></p>
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-11-24T00:00:00+00:00">November 24, 2022</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Advanced+access+restriction+scenarios+in+Azure+App+Service%20https%3A%2F%2Fazure.github.io%2FAppService%2F2022%2F11%2F24%2FAdvanced-access-restriction-scenarios-in-Azure-App-Service.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fazure.github.io%2FAppService%2F2022%2F11%2F24%2FAdvanced-access-restriction-scenarios-in-Azure-App-Service.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fazure.github.io%2FAppService%2F2022%2F11%2F24%2FAdvanced-access-restriction-scenarios-in-Azure-App-Service.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/AppService/2022/11/08/dotnet7_ga.html" class="pagination--pager" title=".NET 7 GA available on App Service
">Previous</a>
    
    
      <a href="/AppService/2022/12/01/Announcing-Larger-Isolatedv2-SKUs.html" class="pagination--pager" title="Announcing Larger SKUs for App Service Environment v3
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/11/04/app-service-agent-framework-part-3.html" rel="permalink">Part 3: Client-Side Multi-Agent Orchestration on Azure App Service with Microsoft Agent Framework
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  12 minute read

        
        
          • By Jordan Selig
        
        • November 4, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">In Part 2 of this series, I showed you how to build sophisticated multi-agent systems on Azure App Service using Azure AI Foundry Agents—server-side managed ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/31/app-service-agent-framework-part-2.html" rel="permalink">Part 2: Build Long-Running AI Agents on Azure App Service with Microsoft Agent Framework
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  9 minute read

        
        
          • By Jordan Selig
        
        • October 31, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">Last week, I shared how to build long-running AI agents on Azure App Service with Microsoft Agent Framework. If you haven’t seen that post yet, I would recom...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/29/node24-available.html" rel="permalink">Node.js 24 is now available on Azure App Service for Linux
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

        
        
          • By Tulika Chaudharie
        
        • October 29, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">Node.js 24 LTS is live on Azure App Service for Linux. You can create a new Node 24 app through the Azure portal, automate it with the Azure CLI, or roll it ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/29/VSTS-tasks-for-sidecars.html" rel="permalink">Azure Pipeline samples: add sidecars to Azure App Service for Linux
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

        
        
          • By Tulika Chaudharie
        
        • October 29, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">Sidecars on Azure App Service let you attach extra containers — logging, telemetry, lightweight APIs, caches, AI inference helpers — alongside your main app,...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id">
    <label class="sr-only" for="cse-search-input-box-id">
      Enter your search term...
    </label>
    <input type="search" id="cse-search-input-box-id" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results">
    <gcse:searchresults-only></gcse:searchresults-only>
  </div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  
    <a class="page-microsoft" href="https://www.microsoft.com"><img src="/AppService/media/pages/Microsoft_logo.svg" alt=""></a>
  
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/AzAppService" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/Azure/AppService" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/AppService/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 Azure App Service. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/AppService/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>


<script>
  (function () {
    var cx = '015057007851139702326:ob8gaepprli';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
    $(document).ready(function () {
      $('input#cse-search-input-box-id').on('keyup', function () {
        googleCustomSearchExecute();
      });
    });
  
</script>




  <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-112478220-2']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>









  </body>
</html>
