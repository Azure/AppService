<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>A/B Testing with App Service, Part 3: Analyzing the telemetry - Azure App Service</title>
<meta name="description" content="This is the third article in our guide for A/B testing with App Service. The first article shows how to set up your client-side project. The second article shows how to configure your backend.  Share your thoughts in the comments section.Now that our client-side and backend projects are configured, we can analyze the data and compare results using Application Insights. Open the Azure Portal and open your Application Insights resource that you created in the first article. On the left side, open Logs under Monitoring.Example 1: Comparing request durationThis example will show three slots. The staging slot is where our main branch is deployed to every time there is a push to the main branch. The other two slots, labeled 219 and 230, are both pull requests targeting the main branch. We are using App Service’s deployment slots as a staging environment to deploy the pull requests on so we can test them before merging.Our goal in this example is to compare the average request durations for an important API call in the application. If we identify that one of the pull requests regresses the performance of that API, then we can investigate the PR’s changes more closely so we don’t regress performance in production.The queryLet’s walk through the query step-by-step. We will use the dependencies table which shows outbound calls from our client-side application.  Next, create two columns using the extends command. The first column, time_bin, bins the timestamp into 5 minute windows which makes our data less noisy. The other column, slot, parses the slot name from the customDimension column.dependencies| extend    time_bin = bin(timestamp, 5m),    slot = tostring(parse_json(customDimensions).slot)We will also specify a time window of 24 hours, and filter the rows to show only POST calls to /api/flights/reserve. You can expand or narrow the time window depending on the amount of telemetry your application emits. And you should also change the API path to a valid request in your application. On the last line, project drops all columns except for slot, time_bin, and duration.| where timestamp &gt; ago(24h)  and name == &quot;POST /api/flights/reserve&quot;| project slot, time_bin, durationBefore we render the timechart, use the evaluate pivot(..) command to rotate the table by turning the unique values in the slot column into multiple columns.  This command will also take the average request duration by each time_bin and slot.| evaluate pivot(slot, avg(duration))| render timechart with ( title=&quot;Request duration by slot&quot;)The graphWhen the query is executed, you should get a graph similar to the one shown below. Each line represents a deployment slot. The y-axis shows the request duration, and the x-axis shows the time. In the example shown below, we can see that customers that are routed to the slot “230” are experiencing very long request durations. Knowing this, we can investigate the changes in that Pull Request and fix the problem before merging.Example 2: Comparing custom metricsYou can use Application Insight’s telemetryClient.trackMetric() and telemetryClient.trackEvent() methods to track custom metrics and events. In this scenario, we are emitting a custom metric to track the average duration of a database query in milliseconds. You could also track the time spent for other backend operations, such as heavy data processing or I/O operations.The queryYour custom metrics are tracked in the customMetrics table. The first step is to filter the custom metric rows to the metric of interest, which is query_time in this case. Like before, create a new column, slot, from the customDimensions table. Next, take the average value for each slot.customMetrics| where name == &quot;query_time&quot;| extend slot = tostring(parse_json(customDimensions).SLOT_NAME)| summarize avg(value) by slotThe final step is to render a bar chart and clean up the labels. The order by slot ensures that the bars of the bar chart are always rendered in the same order.| order by slot| render barchart with ( title=&quot;Average query time by slot&quot;, ytitle=&quot;Query time in ms&quot;, xtitle=&quot;Slot name&quot;)The graphSimilar to the previous example, this chart shows us that Pull Request 232 is greatly improving the query performance under real-world traffic. This is a good sign, and gives developers or QA teams another data point for the PR review process.Monitoring dashboardsYou can use Azure Monitor Workbooks to monitor your experiments and quickly gauge results across your queries. To get started, open your Application Insights resource in the Portal and open the Workbooks blade. Then click + New.The workbook will open with a default Markdown section and graph. Click the Edit button below the graph and paste one of the earlier queries. Click Done Editing at the bottom to save the query. You can also annotate your workbook with notes, links, and lists using Markdown.ResourcesReference Documentation  Kusto Query tutorial  Parse JSON method">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Azure App Service">
<meta property="og:title" content="A/B Testing with App Service, Part 3: Analyzing the telemetry">
<meta property="og:url" content="https://azure.github.io/AppService/2020/10/20/ab_testing_app_service3.html">


  <meta property="og:description" content="This is the third article in our guide for A/B testing with App Service. The first article shows how to set up your client-side project. The second article shows how to configure your backend.  Share your thoughts in the comments section.Now that our client-side and backend projects are configured, we can analyze the data and compare results using Application Insights. Open the Azure Portal and open your Application Insights resource that you created in the first article. On the left side, open Logs under Monitoring.Example 1: Comparing request durationThis example will show three slots. The staging slot is where our main branch is deployed to every time there is a push to the main branch. The other two slots, labeled 219 and 230, are both pull requests targeting the main branch. We are using App Service’s deployment slots as a staging environment to deploy the pull requests on so we can test them before merging.Our goal in this example is to compare the average request durations for an important API call in the application. If we identify that one of the pull requests regresses the performance of that API, then we can investigate the PR’s changes more closely so we don’t regress performance in production.The queryLet’s walk through the query step-by-step. We will use the dependencies table which shows outbound calls from our client-side application.  Next, create two columns using the extends command. The first column, time_bin, bins the timestamp into 5 minute windows which makes our data less noisy. The other column, slot, parses the slot name from the customDimension column.dependencies| extend    time_bin = bin(timestamp, 5m),    slot = tostring(parse_json(customDimensions).slot)We will also specify a time window of 24 hours, and filter the rows to show only POST calls to /api/flights/reserve. You can expand or narrow the time window depending on the amount of telemetry your application emits. And you should also change the API path to a valid request in your application. On the last line, project drops all columns except for slot, time_bin, and duration.| where timestamp &gt; ago(24h)  and name == &quot;POST /api/flights/reserve&quot;| project slot, time_bin, durationBefore we render the timechart, use the evaluate pivot(..) command to rotate the table by turning the unique values in the slot column into multiple columns.  This command will also take the average request duration by each time_bin and slot.| evaluate pivot(slot, avg(duration))| render timechart with ( title=&quot;Request duration by slot&quot;)The graphWhen the query is executed, you should get a graph similar to the one shown below. Each line represents a deployment slot. The y-axis shows the request duration, and the x-axis shows the time. In the example shown below, we can see that customers that are routed to the slot “230” are experiencing very long request durations. Knowing this, we can investigate the changes in that Pull Request and fix the problem before merging.Example 2: Comparing custom metricsYou can use Application Insight’s telemetryClient.trackMetric() and telemetryClient.trackEvent() methods to track custom metrics and events. In this scenario, we are emitting a custom metric to track the average duration of a database query in milliseconds. You could also track the time spent for other backend operations, such as heavy data processing or I/O operations.The queryYour custom metrics are tracked in the customMetrics table. The first step is to filter the custom metric rows to the metric of interest, which is query_time in this case. Like before, create a new column, slot, from the customDimensions table. Next, take the average value for each slot.customMetrics| where name == &quot;query_time&quot;| extend slot = tostring(parse_json(customDimensions).SLOT_NAME)| summarize avg(value) by slotThe final step is to render a bar chart and clean up the labels. The order by slot ensures that the bars of the bar chart are always rendered in the same order.| order by slot| render barchart with ( title=&quot;Average query time by slot&quot;, ytitle=&quot;Query time in ms&quot;, xtitle=&quot;Slot name&quot;)The graphSimilar to the previous example, this chart shows us that Pull Request 232 is greatly improving the query performance under real-world traffic. This is a good sign, and gives developers or QA teams another data point for the PR review process.Monitoring dashboardsYou can use Azure Monitor Workbooks to monitor your experiments and quickly gauge results across your queries. To get started, open your Application Insights resource in the Portal and open the Workbooks blade. Then click + New.The workbook will open with a default Markdown section and graph. Click the Edit button below the graph and paste one of the earlier queries. Click Done Editing at the bottom to save the query. You can also annotate your workbook with notes, links, and lists using Markdown.ResourcesReference Documentation  Kusto Query tutorial  Parse JSON method">



  <meta property="og:image" content="https://azure.github.io/AppService/assets/images/icon.png">





  <meta property="article:published_time" content="2020-10-20T00:00:00+00:00">





  

  


<link rel="canonical" href="https://azure.github.io/AppService/2020/10/20/ab_testing_app_service3.html">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://azure.github.io/AppService",
      "logo": "https://azure.github.io/AppService/assets/images/icon.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Azure App Service",
      "url": "https://azure.github.io/AppService",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/AppService/feed.xml" type="application/atom+xml" rel="alternate" title="Azure App Service Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/AppService/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->

<!-- Jekyll env: production -->



    <!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" 
      type="image/png" 
      href="/AppService/media/pages/new_app_service_logo_16.png">
<link rel="shortcut icon" 
      type="image/png" 
      href="/AppService/media/pages/new_app_service_logo_16.png">

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/AppService/"><img src="/AppService/media/pages/new_app_service_logo_64.svg" alt=""></a>
        
        <a class="site-title" href="/AppService/">
          Azure App Service
          <span class="site-subtitle">Team Blog</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/AppService/tags/" >Tags</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/AppService/"><span class="nav__sub-title">Home</span></a>
        

        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Product Areas</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="/AppService/networking/" class="">Networking & ASE</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/java/" class="">Java</a>
              
                
                
                
                
    
                
                
                <ul>
                  <li style="padding-left: 6px;"><a href="/AppService/java/videos/" class="">Videos</a></li>
                </ul>
                
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/diagnostics/" class="">Diagnostics</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/certsdomains/" class="">Certs and Domains</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/deployment/" class="">Deployment, CI/CD, Slots</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/windows-containers/" class="">Windows Containers</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/sidecars/" class="">Sidecars</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/ai-integration/" class="">AI Integration</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Reference</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="https://docs.microsoft.com/azure/app-service/" class="">Documentation</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://github.com/Azure/app-service-linux-docs" class="">Linux FAQ</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://aka.ms/appservicewindowscontainerwiki" class="">Windows Containers Wiki</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/zero-to-hero/" class="">Zero to Hero tutorials</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">More</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="https://twitter.com/Azure" class="">Twitter</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/feed.xml" class="">RSS Feed</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://azure.microsoft.com/blog/" class="">Azure Blog</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="https://azure.microsoft.com/updates/" class="">Azure Updates</a>
              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Archives</span>
        

        
        <ul>
          
            
            

            
            

            <li>
              <a href="/AppService/2020" class="">2020</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2019" class="">2019</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2018" class="">2018</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2017" class="">2017</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/2016" class="">2016</a>
              
            </li>
          
            
            

            
            

            <li>
              <a href="/AppService/posts/" class="">All posts</a>
              
            </li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="A/B Testing with App Service, Part 3: Analyzing the telemetry">
    <meta itemprop="description" content="This is the third article in our guide for A/B testing with App Service. The first article shows how to set up your client-side project. The second article shows how to configure your backend.  Share your thoughts in the comments section.Now that our client-side and backend projects are configured, we can analyze the data and compare results using Application Insights. Open the Azure Portal and open your Application Insights resource that you created in the first article. On the left side, open Logs under Monitoring.Example 1: Comparing request durationThis example will show three slots. The staging slot is where our main branch is deployed to every time there is a push to the main branch. The other two slots, labeled 219 and 230, are both pull requests targeting the main branch. We are using App Service’s deployment slots as a staging environment to deploy the pull requests on so we can test them before merging.Our goal in this example is to compare the average request durations for an important API call in the application. If we identify that one of the pull requests regresses the performance of that API, then we can investigate the PR’s changes more closely so we don’t regress performance in production.The queryLet’s walk through the query step-by-step. We will use the dependencies table which shows outbound calls from our client-side application.  Next, create two columns using the extends command. The first column, time_bin, bins the timestamp into 5 minute windows which makes our data less noisy. The other column, slot, parses the slot name from the customDimension column.dependencies| extend    time_bin = bin(timestamp, 5m),    slot = tostring(parse_json(customDimensions).slot)We will also specify a time window of 24 hours, and filter the rows to show only POST calls to /api/flights/reserve. You can expand or narrow the time window depending on the amount of telemetry your application emits. And you should also change the API path to a valid request in your application. On the last line, project drops all columns except for slot, time_bin, and duration.| where timestamp &gt; ago(24h)  and name == &quot;POST /api/flights/reserve&quot;| project slot, time_bin, durationBefore we render the timechart, use the evaluate pivot(..) command to rotate the table by turning the unique values in the slot column into multiple columns.  This command will also take the average request duration by each time_bin and slot.| evaluate pivot(slot, avg(duration))| render timechart with ( title=&quot;Request duration by slot&quot;)The graphWhen the query is executed, you should get a graph similar to the one shown below. Each line represents a deployment slot. The y-axis shows the request duration, and the x-axis shows the time. In the example shown below, we can see that customers that are routed to the slot “230” are experiencing very long request durations. Knowing this, we can investigate the changes in that Pull Request and fix the problem before merging.Example 2: Comparing custom metricsYou can use Application Insight’s telemetryClient.trackMetric() and telemetryClient.trackEvent() methods to track custom metrics and events. In this scenario, we are emitting a custom metric to track the average duration of a database query in milliseconds. You could also track the time spent for other backend operations, such as heavy data processing or I/O operations.The queryYour custom metrics are tracked in the customMetrics table. The first step is to filter the custom metric rows to the metric of interest, which is query_time in this case. Like before, create a new column, slot, from the customDimensions table. Next, take the average value for each slot.customMetrics| where name == &quot;query_time&quot;| extend slot = tostring(parse_json(customDimensions).SLOT_NAME)| summarize avg(value) by slotThe final step is to render a bar chart and clean up the labels. The order by slot ensures that the bars of the bar chart are always rendered in the same order.| order by slot| render barchart with ( title=&quot;Average query time by slot&quot;, ytitle=&quot;Query time in ms&quot;, xtitle=&quot;Slot name&quot;)The graphSimilar to the previous example, this chart shows us that Pull Request 232 is greatly improving the query performance under real-world traffic. This is a good sign, and gives developers or QA teams another data point for the PR review process.Monitoring dashboardsYou can use Azure Monitor Workbooks to monitor your experiments and quickly gauge results across your queries. To get started, open your Application Insights resource in the Portal and open the Workbooks blade. Then click + New.The workbook will open with a default Markdown section and graph. Click the Edit button below the graph and paste one of the earlier queries. Click Done Editing at the bottom to save the query. You can also annotate your workbook with notes, links, and lists using Markdown.ResourcesReference Documentation  Kusto Query tutorial  Parse JSON method">
    <meta itemprop="datePublished" content="October 20, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">A/B Testing with App Service, Part 3: Analyzing the telemetry
</h1>
          <p class="page__meta">
            
              <i class="far fa-clock" aria-hidden="true"></i> 




  4 minute read

            
            
              • By Jason Freeberg and Shubham Dhond
            
            • October 20, 2020
          </p>
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#example-1-comparing-request-duration">Example 1: Comparing request duration</a>
    <ul>
      <li><a href="#the-query">The query</a></li>
      <li><a href="#the-graph">The graph</a></li>
    </ul>
  </li>
  <li><a href="#example-2-comparing-custom-metrics">Example 2: Comparing custom metrics</a>
    <ul>
      <li><a href="#the-query-1">The query</a></li>
      <li><a href="#the-graph-1">The graph</a></li>
    </ul>
  </li>
  <li><a href="#monitoring-dashboards">Monitoring dashboards</a></li>
  <li><a href="#resources">Resources</a>
    <ul>
      <li><a href="#reference-documentation">Reference Documentation</a></li>
    </ul>
  </li>
</ul>
            </nav>
          </aside>
        
        <p>This is the third article in our guide for A/B testing with App Service. <a href="https://azure.github.io/AppService/2020/08/03/ab_testing_app_service.html">The first article</a> shows how to set up your client-side project. <a href="https://azure.github.io/AppService/2020/08/24/ab_testing_app_service2.html">The second article</a> shows how to configure your backend.</p>

<blockquote>
  <p>Share your thoughts in the <a href="#disqus_thread">comments section</a>.</p>
</blockquote>

<p>Now that our client-side and backend projects are configured, we can analyze the data and compare results using Application Insights. Open the <a href="https://portal.azure.com/">Azure Portal</a> and open your Application Insights resource that you created in the first article. On the left side, open <strong>Logs</strong> under <strong>Monitoring</strong>.</p>

<p><img src="/AppService/media/2020/10/ab-testing-logs-button-portal.png" alt="Open the Logs tab on Application Insights" /></p>

<h2 id="example-1-comparing-request-duration">Example 1: Comparing request duration</h2>

<p>This example will show three slots. The <strong>staging</strong> slot is where our main branch is deployed to every time there is a push to the main branch. The other two slots, labeled <strong>219</strong> and <strong>230</strong>, are both pull requests targeting the main branch. We are using App Service’s deployment slots as a staging environment to deploy the pull requests on so we can test them before merging.</p>

<p>Our goal in this example is to compare the average request durations for an important API call in the application. If we identify that one of the pull requests regresses the performance of that API, then we can investigate the PR’s changes more closely so we don’t regress performance in production.</p>

<h3 id="the-query">The query</h3>

<p>Let’s walk through the query step-by-step. We will use the <code class="language-plaintext highlighter-rouge">dependencies</code> table which shows outbound calls from our client-side application.  Next, create two columns using the <code class="language-plaintext highlighter-rouge">extends</code> command. The first column, <code class="language-plaintext highlighter-rouge">time_bin</code>, bins the timestamp into 5 minute windows which makes our data less noisy. The other column, <code class="language-plaintext highlighter-rouge">slot</code>, parses the slot name from the <code class="language-plaintext highlighter-rouge">customDimension</code> column.</p>

<pre><code class="language-txt">dependencies
| extend
    time_bin = bin(timestamp, 5m),
    slot = tostring(parse_json(customDimensions).slot)
</code></pre>

<p>We will also specify a time window of 24 hours, and filter the rows to show only POST calls to <code class="language-plaintext highlighter-rouge">/api/flights/reserve</code>. You can expand or narrow the time window depending on the amount of telemetry your application emits. And you should also change the API path to a valid request in your application. On the last line, <code class="language-plaintext highlighter-rouge">project</code> drops all columns except for <code class="language-plaintext highlighter-rouge">slot</code>, <code class="language-plaintext highlighter-rouge">time_bin</code>, and <code class="language-plaintext highlighter-rouge">duration</code>.</p>

<pre><code class="language-txt">| where timestamp &gt; ago(24h)
  and name == "POST /api/flights/reserve"
| project slot, time_bin, duration
</code></pre>

<p>Before we render the timechart, use the <code class="language-plaintext highlighter-rouge">evaluate pivot(..)</code> command to rotate the table by turning the unique values in the <strong>slot</strong> column into multiple columns.  This command will also take the average request duration by each time_bin and slot.</p>

<pre><code class="language-txt">| evaluate pivot(slot, avg(duration))
| render timechart with ( title="Request duration by slot")
</code></pre>

<h3 id="the-graph">The graph</h3>

<p>When the query is executed, you should get a graph similar to the one shown below. Each line represents a deployment slot. The y-axis shows the request duration, and the x-axis shows the time. In the example shown below, we can see that customers that are routed to the slot “230” are experiencing very long request durations. Knowing this, we can investigate the changes in that Pull Request and fix the problem before merging.</p>

<p><img src="/AppService/media/2020/10/ab-testing-request-duration-by-slot-graph.png" alt="Graph of request duration by slot" /></p>

<h2 id="example-2-comparing-custom-metrics">Example 2: Comparing custom metrics</h2>

<p>You can use Application Insight’s <a href="https://docs.microsoft.com/azure/azure-monitor/app/api-custom-events-metrics#trackmetric"><code class="language-plaintext highlighter-rouge">telemetryClient.trackMetric()</code></a> and <a href="https://docs.microsoft.com/azure/azure-monitor/app/api-custom-events-metrics#trackevent"><code class="language-plaintext highlighter-rouge">telemetryClient.trackEvent()</code></a> methods to track custom metrics and events. In this scenario, we are emitting a custom metric to track the average duration of a database query in milliseconds. You could also track the time spent for other backend operations, such as heavy data processing or I/O operations.</p>

<h3 id="the-query-1">The query</h3>

<p>Your custom metrics are tracked in the <code class="language-plaintext highlighter-rouge">customMetrics</code> table. The first step is to filter the custom metric rows to the metric of interest, which is <code class="language-plaintext highlighter-rouge">query_time</code> in this case. Like before, create a new column, <code class="language-plaintext highlighter-rouge">slot</code>, from the <code class="language-plaintext highlighter-rouge">customDimensions</code> table. Next, take the average value for each slot.</p>

<pre><code class="language-txt">customMetrics
| where name == "query_time"
| extend slot = tostring(parse_json(customDimensions).SLOT_NAME)
| summarize avg(value) by slot
</code></pre>

<p>The final step is to render a bar chart and clean up the labels. The <code class="language-plaintext highlighter-rouge">order by slot</code> ensures that the bars of the bar chart are always rendered in the same order.</p>

<pre><code class="language-txt">| order by slot
| render barchart with ( title="Average query time by slot", ytitle="Query time in ms", xtitle="Slot name")
</code></pre>

<h3 id="the-graph-1">The graph</h3>

<p>Similar to the previous example, this chart shows us that Pull Request 232 is greatly improving the query performance under real-world traffic. This is a good sign, and gives developers or QA teams another data point for the PR review process.</p>

<p><img src="/AppService/media/2020/10/ab-testing-query-time-by-slot-graph.png" alt="Graph of request duration by slot" /></p>

<h2 id="monitoring-dashboards">Monitoring dashboards</h2>

<p>You can use Azure Monitor Workbooks to monitor your experiments and quickly gauge results across your queries. To get started, open your Application Insights resource in the Portal and open the <strong>Workbooks</strong> blade. Then click <strong>+ New</strong>.</p>

<p><img src="/AppService/media/2020/10/ab-testing-create-workbook.png" alt="Create a new Azure Monitor Workbook" /></p>

<p>The workbook will open with a default Markdown section and graph. Click the <strong>Edit</strong> button below the graph and paste one of the earlier queries. Click <strong>Done Editing</strong> at the bottom to save the query. You can also annotate your workbook with notes, links, and lists using Markdown.</p>

<p><img src="/AppService/media/2020/10/ai-workbook.gif" alt="Azure Monitor workbook" /></p>

<h2 id="resources">Resources</h2>

<h3 id="reference-documentation">Reference Documentation</h3>

<ul>
  <li><a href="https://docs.microsoft.com/azure/data-explorer/kusto/query/tutorial?pivots=azuredataexplorer">Kusto Query tutorial</a></li>
  <li><a href="https://docs.microsoft.com/azure/data-explorer/kusto/query/parsejsonfunction">Parse JSON method</a></li>
</ul>

        
      </section>

      <footer class="page__meta">
          <p class="page__date"><strong><a href="https://docs.microsoft.com/answers/topics/azure-webapps.html">Post questions</a> | <a href="https://feedback.azure.com/forums/169385-web-apps">Provide product feedback</a></strong></p>
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-10-20T00:00:00+00:00">October 20, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=A%2FB+Testing+with+App+Service%2C+Part+3%3A+Analyzing+the+telemetry%20https%3A%2F%2Fazure.github.io%2FAppService%2F2020%2F10%2F20%2Fab_testing_app_service3.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fazure.github.io%2FAppService%2F2020%2F10%2F20%2Fab_testing_app_service3.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fazure.github.io%2FAppService%2F2020%2F10%2F20%2Fab_testing_app_service3.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/AppService/2020/10/15/Docker-Hub-authenticated-pulls-on-App-Service.html" class="pagination--pager" title="Docker Hub authenticated pulls on App Service
">Previous</a>
    
    
      <a href="/AppService/2020/11/10/Dot-Net-5-on-App-Service.html" class="pagination--pager" title=".NET 5 on App Service
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/21/app-service-agent-framework.html" rel="permalink">Build Long-Running AI Agents on Azure App Service with Microsoft Agent Framework
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read

        
        
          • By Jordan Selig
        
        • October 21, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">The AI landscape is evolving rapidly, and with the introduction of Microsoft Agent Framework, developers now have a powerful platform for building sophistica...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/20/dotnet-on-windows.html" rel="permalink">Platform updates for .NET on App Service Windows
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

        
        
          • By Byron Tardif
        
        • October 20, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">
  UPDATE:

  
    Patch deployment has completed on all instances of our HTTP load balancer infrastructure (aka Front Ends).
    Clarified impact to Functio...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/10/14/Ubuntu-images.html" rel="permalink">Ubuntu-Powered Runtimes on Azure App Service for Linux: Leaner, Faster, Stronger
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

        
        
          • By Tulika Chaudharie
        
        • October 14, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">We’re updating the OS foundation for new code-based stacks on Azure App Service for Linux. Every new major version of our supported stacks will target Ubuntu...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/AppService/media/pages/new_app_service_logo_64.svg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AppService/2025/09/08/Oryx-build-certificate.html" rel="permalink">App Service builds behind proxies: fixing trust with a public certificate
</a>
      
    </h2>
    
      <p class="page__meta">
        
          <i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

        
        
          • By Tulika Chaudharie
        
        • September 8, 2025
      </p>
    
    <p class="archive__item-excerpt" itemprop="description">TL;DR: If your organization uses a TLS-inspecting proxy (e.g., Zscaler), some of the traffic originating from App Service build infrastructure may be re-sign...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id">
    <label class="sr-only" for="cse-search-input-box-id">
      Enter your search term...
    </label>
    <input type="search" id="cse-search-input-box-id" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results">
    <gcse:searchresults-only></gcse:searchresults-only>
  </div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  
    <a class="page-microsoft" href="https://www.microsoft.com"><img src="/AppService/media/pages/Microsoft_logo.svg" alt=""></a>
  
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/AzAppService" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/Azure/AppService" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/AppService/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 Azure App Service. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/AppService/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>


<script>
  (function () {
    var cx = '015057007851139702326:ob8gaepprli';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
    $(document).ready(function () {
      $('input#cse-search-input-box-id').on('keyup', function () {
        googleCustomSearchExecute();
      });
    });
  
</script>




  <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-112478220-2']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://azure.github.io/AppService/2020/10/20/ab_testing_app_service3.html";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2020/10/20/ab_testing_app_service3"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://app-service-blog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
